"use strict";var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var BubbleLegend=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.class=e.class,this.draw()}return _createClass(t,[{key:"draw",value:function(){var t=this;t.element.selectAll("*").remove();var e=t.element.append("div").attr("class",t.class).style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(a,n){t.element.append("img").attr("src","img dump/"+a.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){e.text(a.tooltip),e.style("visibility","visible")}).on("mousemove",function(){e.style("top",24*n+5+"px").style("right","40px")}).on("mouseout",function(){return e.style("visibility","hidden")})})}}]),t}();!function(t,e,a){a.vibrant||(a.vibrant={}),a.loadFramework=function(t){!function(t,n){i=a.vibrant.city||"Austin",e(".city").text(i),e.isFunction(n)&&n();var i}(0,t)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadLanding=function(n){!function(n,i){function r(n){e("#landing-content").empty().load("landingcity-"+n.toLowerCase()+".html",function(i){!function(e){new BubbleLegend({element:t.select("#traded-bubble-legend div"),class:"traded-bubble-legend-tooltip"}),a=e,t.queue(2).defer(t.csv,"./data/"+a+"_Master_Traded.csv").defer(t.csv,"./data/color_legend2.csv").await(function(e,a,n){if(e)throw e;var i,r;i=a,r=n,new TradedBubble({element:t.select("#traded-bubble-wrapper"),data:i,colors:r})});var a}(n),function(n){e("#local-view").off().on("click",function(){o(n)}),e("#national-view").off().on("click",function(){o("national")}),new BubbleLegend({element:t.select("#network-bubble-legend div"),class:"network-bubble-legend-tooltip"});var i=e("#header").outerHeight(!0)+e("#footer").outerHeight(!0),r=e(a).height()-i;function o(n){var i=t.select("#network-wrapper");i.selectAll("*").remove();e(a);i.append("iframe").attr("width",Math.floor(e("#landing-container").width()||e(a).width())||"100%").attr("height",Math.floor(r)+"px").attr("src",n.toLowerCase()+".html")}o(n)}(n)})}a.vibrant.city="",t.queue(2).defer(t.json,"./data/cities.json").await(function(n,i){if(n)throw n;var o=t.select("#cities-img-wrapper");o.selectAll("*").remove(),i.map(function(t){var n=o.append("div").attr("class","city-img-wrapper"),i=n.append("div").attr("class","city-img").on("click",function(){e("#landing-content").removeClass("hidden"),a.vibrant.city=t.city;var n="landing";a.history.pushState({page:n,city:a.vibrant.city},n,"?page="+n+"&city="+a.vibrant.city),r(a.vibrant.city)});i.append("img").attr("src","./img/"+t.city.toLowerCase()+".jpg"),i.append("p").text(t.city+", "+t.state)}),a.vibrant.city&&r(a.vibrant.city)}),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadLocal=function(n){!function(n,i){var r=a.vibrant.city||"Austin";function o(n){e(".city").text(n),t.queue(2).defer(t.csv,"./data/"+n+"_Master_Local.csv").defer(t.csv,"./data/color_legend.csv").await(function(n,i,r){if(n)throw n;var o,s,l,c,d;o=i,s=r,new LocalTable({element:t.select("#local-table-wrapper"),data:o,colors:s,count:void 0}),l=i,c=r,d=new LocalBubble({element:t.select("#local-bubble-wrapper"),data:l,colors:c}),e(a).on("resize",function(){return d.draw()})})}e(".dropdown-value").text(r),e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),a.vibrant.city=r,e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),o(r);var t="local";a.history.pushState({page:t,city:a.vibrant.city},t,"?page=local&city="+a.vibrant.city)}),new BubbleLegend({element:t.select("#local-bubble-legend div"),class:"local-bubble-legend-tooltip"}),o(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadNetwork=function(n){!function(n,i){var r="National";e(".dropdown-value").text(r),e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),a.vibrant.city="National"===r?a.vibrant.city:r,e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),s(r);var t="network";a.history.pushState({page:t,city:a.vibrant.city},t,"?page="+t+"&city="+a.vibrant.city)});var o=e(a).height()-e("#header").outerHeight(!0)+5-e("#footer").outerHeight(!0);function s(n){e(".city").text(n),e(".expandable").click(function(){e(".collapsible").slideToggle("slow")});var i=t.select("#network-wrapper");i.selectAll("*").remove();e(a);i.append("iframe").attr("width",Math.floor(e("#network").width()||e(a).width())+"px"||"100%").attr("height",Math.floor(o)+"px").attr("src",n.toLowerCase()+".html")}s(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadSwot=function(t){!function(t,n){var i=a.vibrant.city||"Austin";function r(t){e(".city").text(t),new swotTable({activeCity:t,type:"strengths"}),new swotTable({activeCity:t,type:"weaknesses"}),new swotTable({activeCity:t,type:"opportunities"}),new swotTable({activeCity:t,type:"threats"})}e(".dropdown-value").text(i),e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){i=e(this).data("value"),a.vibrant.city=i,e(".dropdown-value").text(i),e(".dropdown-hidden").toggleClass("visibility-visible"),r(i);var t="swot";a.history.pushState({page:t,city:a.vibrant.city},t,"?page=swot&city="+a.vibrant.city)}),r(i),e.isFunction(n)&&n()}(0,t)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadTraded=function(n){!function(n,i){var r=a.vibrant.city||"Austin";function o(a){e(".city").text(a),t.queue(2).defer(t.csv,"./data/"+a+"_Master_Traded.csv").defer(t.csv,"./data/color_legend2.csv").await(function(e,a,n){if(e)throw e;var i,r,o;i=a,r=n,new TradedBubble({element:t.select("#traded-bubble-wrapper"),data:i,colors:r}),o=a,new TradedTable({element:t.select("#traded-table-wrapper"),data:o,count:void 0})})}e(".dropdown-value").text(r),e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),a.vibrant.city=r,e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),o(r);var t="traded";a.history.pushState({page:t,city:a.vibrant.city},t,"?page=traded&city="+a.vibrant.city)}),new BubbleLegend({element:t.select("#traded-bubble-legend div"),class:"traded-bubble-legend-tooltip"}),o(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadTrends=function(n){!function(n,i){var r=a.vibrant.city||"Austin";function o(n,i){new TrendsTable({element:t.select("#trends-table-wrapper"),data:n,colors:i,count:void 0,callback:function(n){var i,r,o;r=(i=n).bubbleByYear[i.year].slice(0,50),o=new TrendsBubble({element:t.select("#trends-bubble-wrapper").node(),data:r,year:i.yearLabel,datas:i.bubbleByYear,years:i.years,absMaxX:i.absMaxX,absMaxY:i.absMaxY}),e(a).on("resize",function(){return o.draw()})}})}function s(a){e(".city").text(a),t.queue(2).defer(t.csv,"./data/"+a+"_Master_Traded.csv").defer(t.csv,"./data/color_legend.csv").await(function(t,e,a){if(t)throw t;o(e,a)})}e(".dropdown-value").text(r),e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),a.vibrant.city=r,e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),s(r);var t="trends";a.history.pushState({page:t,city:a.vibrant.city},t,"?page=trends&city="+a.vibrant.city)}),new BubbleLegend({element:t.select("#trends-bubble-legend div"),class:"trends-bubble-legend-tooltip"}),s(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window);var LocalBubble=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.prepareData(e.data,e.colors),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t,e){var a=d3.format(",");var n=[],i=(t.reduce(function(t,e,a){return t[e.naics]=e,t},{}),e.reduce(function(t,e,a){return t[e.Group]=e,t},{}));t.sort(function(t,e){return+e[2015]-+t[2015]}),t.map(function(t,e){var r;n.push({color:i[t.Group].Hex||"gray",Industry:t.Label,Employees:(r=t[2015],a(+r||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),n.sort(function(t,e){return+e["Relative Size"]-+t["Relative Size"]});var r=n.splice(0,10).concat(n.splice(n.length-10,n.length));this.data=r}},{key:"draw",value:function(){var t=this.element,e=t.node();this.padding=e.getBoundingClientRect(),t.selectAll(".item").remove(),this.width=e.offsetWidth||400,this.height=e.offsetHeight||400,this.margin={top:30,right:100,bottom:70,left:100},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var a=t.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));a.append("defs").append("marker").attr("id","arrow").attr("viewBox","0 -5 10 10").attr("refX",5).attr("refY",0).attr("markerWidth",5).attr("markerHeight",5).attr("orient","auto").append("path").attr("d","M0,-5L10,0L0,5").attr("stroke-width",1).attr("stroke-dasharray",0).attr("class","arrowHead"),this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=t.append("div").attr("class","item local-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(t){var e=this,a=this.tooltip,n=d3.scaleBand().range([0,this.width]).padding(.1),i=d3.scaleLinear().range([0,this.height]),r=d3.scaleLinear().range([5,25]).domain(d3.extent(t,function(t){return+t.Employees.replace(/[^-.0-9]+/g,"")}));n.domain(t.map(function(t){return t.Industry})),i.domain([d3.min(t,function(t){return-t["Relative Size"]}),d3.max(t,function(t){return-t["Relative Size"]})]),this.container.append("line").attr("class","arrow").attr("marker-end","url(#arrow)").style("stroke","#000").style("stroke-width","2px").attr("x1","-20px").attr("x2","-20px").attr("y1",i(-1)).attr("y2",-25),this.container.append("line").attr("class","arrow").attr("marker-end","url(#arrow)").style("stroke","#000").style("stroke-width","2px").attr("x1","-20px").attr("x2","-20px").attr("y1",i(-1)).attr("y2",this.height+25),[{text:"Above",x:-45,y:i(-1)/2-14},{text:"Average",x:-45,y:i(-1)/2+0},{text:"Below",x:-45,y:(this.height+i(-1))/2+6},{text:"Average",x:-45,y:(this.height+i(-1))/2+20}].map(function(t){e.container.append("text").attr("x",t.x).attr("y",t.y).attr("text-anchor","middle").text(t.text)}),this.container.append("line").style("stroke","#000").style("stroke-width","2px").attr("x1","-20px").attr("x2",this.width).attr("y1",i(-1)).attr("y2",i(-1)),this.container.append("text").attr("x",this.width+5).attr("y",i(-1)+4).text("RS = 1");var o=this.padding;this.container.selectAll(".bubble").data(t).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return t.color}).attr("cy",function(t){return t["Relative Size"]>0?i(Math.min(0,-t["Relative Size"])):i(Math.min(0,-t["Relative Size"]))+Math.abs(i(t["Relative Size"])-i(0))}).attr("cx",function(t){return n(t.Industry)+n.bandwidth()/2}).attr("r",function(t,e){return r(t.Employees.replace(/[^-0-9#]+/g,""))}).style("cursor","pointer").on("mouseover",function(t){a.html("<p>"+t.Industry+"</p><p>Relative Size: "+t["Relative Size"]+"</p><p>Employees: "+t.Employees+"</p>"),a.style("visibility","visible")}).on("mousemove",function(t){var e=t["Relative Size"]>0?i(Math.min(0,-t["Relative Size"])):i(Math.min(0,-t["Relative Size"]))+Math.abs(i(t["Relative Size"])-i(0));a.style("top",e+"px").style("left",d3.event.pageX-o.left+10+"px")}).on("mouseout",function(){return a.style("visibility","hidden")})}}]),t}(),LocalTable=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.count=e.count,this.prepareData(e.data,e.colors),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t,e){var a=d3.format(",");var n=[],i=(t.reduce(function(t,e,a){return t[e.naics]=e,t},{}),e.reduce(function(t,e,a){return t[e.Group]=e,t},{}));t.sort(function(t,e){return+e[2015]-+t[2015]}),t.map(function(t,e){var r;n.push({color:i[t.Group].Hex||"gray",Industry:t.Label,Employees:(r=t[2015],a(+r||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),this.count&&(n=n.slice(0,this.count)),this.data=n}},{key:"draw",value:function(){var t=this.element,e=this.data,a=!0;t.selectAll("*").remove(),t.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","local-table-search").on("keyup",function(){var t=this.value.trim().toLowerCase(),e=0;s.each(function(a){var n=d3.select(this),i=-1!=a.Industry.toLowerCase().indexOf(t);n.style("background",e%2?"#fff":"#eee").style("display",i?"table-row":"none"),i&&e++})});var n=t.append("table"),i=d3.keys(e[0]).filter(function(t){return"color"!==t}),r=d3.select(".information-tooltip"),o=n.append("thead").append("tr").selectAll("th").data(i).enter().append("th").each(function(t){if("Relative Size"==t){var e=d3.select(this);e.append("span").text(t).style("white-space","nowrap"),e.append("img").attr("src","images/information.png").attr("alt","information").attr("class","information").on("mouseover",function(){var t=d3.select(this).node().getBoundingClientRect(),e=r.node(),a=$(e).outerWidth(!0),n=$(e).outerHeight(!0),i=$(window).width(),o=(d3.event.pageX||t.left)+10;o+a/2>i?o=i-a-10:o-=a/2;var s=(d3.event.pageY||t.top)-15-n;r.style("top",s+"px").style("left",o+"px"),r.style("visibility","visible")}).on("mouseout",function(){return r.style("visibility","hidden")})}else d3.select(this).text(t)}).on("click",function(t,e){o.attr("class","header"),a?(0===e?s.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):s.sort(function(e,a){return+(e[t]+"").replace(/[^-.0-9]+/g,"")-+(a[t]+"").replace(/[^-.0-9]+/g,"")}),a=!1,this.className="aes"):(0===e?s.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):s.sort(function(e,a){return+(a[t]+"").replace(/[^-.0-9]+/g,"")-+(e[t]+"").replace(/[^-.0-9]+/g,"")}),a=!0,this.className="des"),n.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=n.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return i.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}}]),t}();$(function(){window.vibrant||(window.vibrant={}),window.vibrant.city="Austin";var t,e=/INPUT|SELECT|TEXTAREA/i;function a(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}$(document).bind("keydown keypress",function(t){8==t.which&&(!e.test(t.target.tagName)||t.target.disabled||t.target.readOnly)&&t.preventDefault()}),window.onpopstate=function(t){$(document).ready(function(){i(!0),loadPage({},!0)})},$(document).ready(function(){t=$("#loading-wrapper"),i(!0),$("#navigation .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");loadPage({page:e})}),loadPage({},!0)});var n=_defineProperty({blog:{page:"blog",nav:void 0,event:window.loadLanding,prevAjax:function(){$("#sub-navigation").addClass("hidden"),$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#container").css("margin-top","50px"),t.addClass("hidden")},nextAjax:void 0},contact:{page:"contact",nav:void 0,event:window.loadLanding,prevAjax:function(){$("#sub-navigation").addClass("hidden"),$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#container").css("margin-top","50px"),t.addClass("hidden")},nextAjax:void 0},landing:{page:"landing",nav:void 0,event:window.loadLanding,prevAjax:function(){$("#sub-navigation").addClass("hidden"),$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#container").css("margin-top","50px"),t.addClass("hidden")},nextAjax:void 0},framework:{page:"framework",nav:"graphs",event:window.loadFramework,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}},traded:{page:"traded",nav:"graphs",event:window.loadTraded,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}},trends:{page:"trends",nav:"graphs",event:window.loadTrends,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}},local:{page:"local",nav:"graphs",event:window.loadLocal,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}},swot:{page:"swot",nav:"graphs",event:window.loadSwot,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}},network:{page:"network",nav:"graphs",event:window.loadNetwork,prevAjax:function(){$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}}},"framework",{page:"framework",nav:"graphs",event:window.loadFramework,prevAjax:function(){$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){$(window).scrollTop(0),window.scrollTo(0,0),t.addClass("hidden")}});function i(t){var e=$("#header").height(),a=$(window).height()-e+"px";$("#container").css("margin-top",e),$("#page-wrapper").css("min-height",a).css("height","inherit"),$(".information-tooltip").css("left",0).css("top",0)}$("#sub-navigation-wrapper .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");"nolink"!==e&&($("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+e).addClass("link-to-active"),loadPage({page:e}))}),i(!1),window.loadPage=function(e,r){var o=e.page||a("page",window.location.search)||"landing";window.vibrant.city=a("city",window.location.search)||window.vibrant.city,"nolink"!==o&&(t.removeClass("hidden"),o=o.replace("#","").replace(/[^a-zA-Z]+/g,""),n[o]?("landing"===o&&(window.vibrant.city=""),o&&(window.history.pushState({page:o,city:window.vibrant.city},o,"?page="+o+"&city="+window.vibrant.city),$("#navigation .link-to").removeClass("link-to-active"),$("#navigation .link-to-"+n[o].nav).addClass("link-to-active"),$("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+o).addClass("link-to-active"),r&&i(!1),$("#page-wrapper").empty().load(n[o].page+".html",function(t){$.isFunction(n[o].prevAjax)&&n[o].prevAjax(),$.isFunction(n[o].event)&&n[o].event(n[o].nextAjax)}),function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(e>0)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(t.indexOf("Trident/")>0){var a=t.indexOf("rv:");return parseInt(t.substring(a+3,t.indexOf(".",a)),10)}var n=t.indexOf("Edge/");return n>0&&parseInt(t.substring(n+5,t.indexOf(".",n)),10)}()&&alert("For best viewing experience, please use a modern browser"))):window.open(window.location.origin+"?page=","_self"))},$(window).on("resize",i)});var swotTable=function(){function t(e){_classCallCheck(this,t),this.type=e.type,this.activeCity=e.activeCity,this.color={strengths:{caption:"#4472c4",thead:"#8ea9db",tbody:"#d9e1f2"},weaknesses:{caption:"#ffc000",thead:"#ffd966",tbody:"#fff2cc"},opportunities:{caption:"#70ad47",thead:"#a9d08e",tbody:"#e2efda"},threats:{caption:"#ff0000",thead:"#ff7c80",tbody:"#ffcccc"}},this.draw()}return _createClass(t,[{key:"draw",value:function(){var t=this.activeCity,e=this.type,a=this.color;d3.csv("./data/"+t+"_SWOT_"+e+".csv",function(t,n){if(t)throw t;var i=!0,r=d3.select("#swot-"+e+"-wrapper");r.selectAll(".table").remove();var o=r.append("div").attr("class","table"),s=d3.keys(n[0]);o.append("div").attr("class","caption").text(e.toUpperCase()).style("background",a[e].caption);var l=o.append("div").attr("class","thead").append("div").attr("class","tr").selectAll(".th").data(s).enter().append("div").attr("class","th content-cutted").style("background",a[e].thead).text(function(t){return t}).on("click",function(t,e){l.attr("class","header"),i?(1===e?c.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):c.sort(function(e,a){return+e[t].replace(/[^-.0-9]+/g,"")-+a[t].replace(/[^-.0-9]+/g,"")}),i=!1,this.className="aes"):(1===e?c.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):c.sort(function(e,a){return+a[t].replace(/[^-.0-9]+/g,"")-+e[t].replace(/[^-.0-9]+/g,"")}),i=!0,this.className="des")}),c=o.append("div").attr("class","tbody").selectAll(".tr").data(n).enter().append("div").attr("class","tr").style("background",a[e].tbody);c.selectAll(".td").data(function(t){return s.map(function(e){return{value:t[e],name:e}})}).enter().append("div").attr("class","td content-cutted").attr("data-th",function(t){return t.name}).text(function(t){return t.value})})}}]),t}(),TradedBubble=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.color=d3.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]),this.prepareData(e.data,e.colors),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t,e){Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1};var a=e.reduce(function(t,e,a){return t[e.Group]=e,t},{}),n=$("#traded-bubble-wrapper").width()||960,i=$("#traded-bubble-wrapper").height()||550,r=12,o=[];t.map(function(t){o.push({text:t.Label,size:n>500?+t[2015]:+t[2015]/2,group:t.Group})});var s=[];o.forEach(function(t){s.contains(t.group)||s.push(t.group)});for(var l=o.length,c=s.length,d=new Array(c),h=[],u=0;u<l;u++)h.push(p(o,u));function p(t,e){var o=s.indexOf(t[e].group),l=Math.sqrt((o+1)/c*-Math.log(Math.random()))*r,h={color:a[o].Hex,cluster:o,index:e,radius:.002*t[e].size,text:t[e].text,x:200*Math.cos(o/c*2*Math.PI)+n/2+Math.random(),y:200*Math.sin(o/c*2*Math.PI)+i/2+Math.random()};return(!d[o]||l>d[o].radius)&&(d[o]=h),h}this.graph={nodes:h,links:[]}}},{key:"draw",value:function(){var t=this.element,e=t.node();this.padding=e.getBoundingClientRect(),t.select("svg").selectAll("*").remove(),this.width=e.offsetWidth||400,this.height=e.offsetHeight||400,this.margin={top:0,right:0,bottom:0,left:0},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom),this.width=this.height;var a=t.select("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=t.append("div").attr("class","item traded-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.graph)}},{key:"setData",value:function(t){this.graph=t,this.draw()}},{key:"createBubbles",value:function(t){var e=this,a=this,n=d3.forceSimulation().force("link",d3.forceLink().id(function(t){return t.index})).force("collide",d3.forceCollide(function(t){return t.radius+1}).iterations(12)).force("charge",d3.forceManyBody().strength(-1)).force("center",d3.forceCenter(this.width/2,this.height/2)).force("y",d3.forceY(0)).force("x",d3.forceX(0)),i=this.container.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke","transparent"),r=this.container.append("g").attr("class","nodes").selectAll(".node").data(t.nodes).enter().append("g").attr("class","node"),o=this.padding;r.append("circle").attr("r",function(t){return t.radius||0}).style("fill",function(t){return e.color(t.cluster)||t.color}).style("cursor","pointer").on("mouseover",function(t){a.tooltip.text(t.text),a.tooltip.style("visibility","visible")}).on("mousemove",function(t){a.tooltip.style("top",t.y+"px").style("left",d3.event.pageX-o.left+10+"px")}).on("mouseout",function(){return a.tooltip.style("visibility","hidden")}).call(d3.drag().on("start",function(t){d3.event.active||n.alphaTarget(.3).restart(),a.tooltip.style("visibility","hidden"),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||n.alphaTarget(0),a.tooltip.style("visibility","visible"),t.fx=null,t.fy=null})),r.append("text").attr("class","first-row").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){t.secondRow="";var e=t.text.trim().split(" ");return e[3]&&e[2]&&e[1]&&e[0].length+1+e[1].length+1+e[2].length+1+e[3].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>3&&(t.secondRow=t.secondRow+" "+e)}),e[0]+" "+e[1]+" "+e[2]+" "+e[3]):e[2]&&e[1]&&e[0].length+1+e[1].length+1+e[2].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>2&&(t.secondRow=t.secondRow+" "+e)}),e[0]+" "+e[1]+" "+e[2]):e[1]&&e[0].length+1+e[1].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>1&&(t.secondRow=t.secondRow+" "+e)}),e[0]+" "+e[1]):e[0].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>=1&&(t.secondRow=t.secondRow+" "+e)}),e[0]):(t.isFirstRow=!1,"")}),r.append("text").attr("class","second-row").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){var e=t.secondRow.trim().split(" ");return 1===e.length&&""===e[0]?(t.isSecondRow=!1,""):t.isFirstRow&&e[2]&&e[1]&&e[0].length+1+e[1].length+1+e[2].length<t.radius/3?(t.isSecondRow=!0,e[0]+" "+e[1]+" "+e[2]):t.isFirstRow&&e[1]&&e[0].length+1+e[1].length<t.radius/3?(t.isSecondRow=!0,e[0]+" "+e[1]):t.isFirstRow&&e[0].length<t.radius/3?(t.isSecondRow=!0,e[0]):(t.isSecondRow=!1,"")});n.nodes(t.nodes).on("tick",function(){r.each(function(t){var e=d3.select(this);t.x=Math.max(t.radius,Math.min(a.width-t.radius,t.x)),t.y=Math.max(t.radius,Math.min(a.height-t.radius,t.y)),e.select("circle").attr("cx",t.x).attr("cy",t.y),e.select(".first-row").attr("x",t.x).attr("y",t.isSecondRow?t.y-6:t.y),e.select(".second-row").attr("x",t.x).attr("y",t.isSecondRow?t.y+6:t.y)}),i.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})}),n.force("link").links(t.links)}}]),t}(),TradedTable=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.count=e.count,this.prepareData(e.data),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t){var e=d3.format(",");function a(t){return e(+t||0)||0}var n=[];t.map(function(t){t["Relative Size (RS)"]=(+t["Relative Size (RS)"]).toFixed(2),t.Employees=a(t.Employees),n.push({NAICS:t.naics,Description:t.Label,Employees:a(+t[2015]),"Relative Size":(+t.RS_2015).toFixed(2),"% Total":(100*+t.Pct_Total).toFixed(2)+"%"})}),n.sort(function(t,e){return+e.Employees.replace(/[^-.0-9]+/g,"")-+t.Employees.replace(/[^-.0-9]+/g,"")}),this.count&&(n=n.slice(0,this.count)),this.data=n}},{key:"draw",value:function(){var t=this.element,e=this.data,a=!0;t.selectAll("*").remove(),t.append("div").append("input").attr("placeholder","Search by Description...").attr("type","text").attr("id","traded-table-search").on("keyup",function(){var t=this.value.trim().toLowerCase(),e=0;s.each(function(a){var n=d3.select(this),i=-1!=a.Description.toLowerCase().indexOf(t);n.style("background",e%2?"#fff":"#eee").style("display",i?"table-row":"none"),i&&e++})});var n=t.append("table"),i=d3.keys(e[0]),r=d3.select(".information-tooltip"),o=n.append("thead").append("tr").selectAll("th").data(i).enter().append("th").each(function(t){if("Relative Size"==t){var e=d3.select(this);e.append("span").text(t).style("white-space","nowrap"),e.append("img").attr("src","images/information.png").attr("alt","information").attr("class","information").on("mouseover",function(){var t=d3.select(this).node().getBoundingClientRect(),e=r.node(),a=$(e).outerWidth(!0),n=$(e).outerHeight(!0),i=$(window).width(),o=(d3.event.pageX||t.left)+10;o+a/2>i?o=i-a-10:o-=a/2;var s=(d3.event.pageY||t.top)-15-n;r.style("top",s+"px").style("left",o+"px"),r.style("visibility","visible")}).on("mouseout",function(){return r.style("visibility","hidden")})}else d3.select(this).text(t)}).on("click",function(t,e){o.attr("class","header"),a?(1===e?s.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):s.sort(function(e,a){return+e[t].replace(/[^-.0-9]+/g,"")-+a[t].replace(/[^-.0-9]+/g,"")}),a=!1,this.className="aes"):(1===e?s.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):s.sort(function(e,a){return+a[t].replace(/[^-.0-9]+/g,"")-+e[t].replace(/[^-.0-9]+/g,"")}),a=!0,this.className="des"),n.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=n.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return i.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}}]),t}(),TrendsBubble=function(){function t(e){_classCallCheck(this,t),this.data=e.data,this.year=e.year||"",this.datas=e.datas,this.years=e.years||"",this.absMaxX=e.absMaxX||0,this.absMaxY=e.absMaxY||0,this.element=e.element,this.draw()}return _createClass(t,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400;var t=Math.min(this.width,this.height);this.width=t,this.height=t,this.margin={top:40,right:40,bottom:40,left:40},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom),this.width=this.height;var e=d3.select(this.element);e.select("svg").selectAll("*").remove(),this.padding=e.node().getBoundingClientRect();var a=e.select("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.clip=a.append("defs").append("clipPath").attr("id","line-clip").append("rect").attr("width",this.width).attr("height",this.height),this.createBubbles()}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(){var t=this;function e(t,a){var n=(e.canvas||(e.canvas=document.createElement("canvas"))).getContext("2d");return n.font=a||'24px "Helvetica Neue"',n.measureText(t).width}var a=this,n=d3.scaleLinear().range([0,this.width]),i=d3.scaleLinear().range([this.height,0]),r=d3.min(this.data,function(t){return t["National Trend"]}),o=d3.max(this.data,function(t){return t["National Trend"]}),s=Math.max(Math.abs(r),Math.abs(o)),l=d3.min(this.data,function(t){return t["Local Trend"]}),c=d3.max(this.data,function(t){return t["Local Trend"]}),d=Math.max(Math.abs(l),Math.abs(c)),h=.24*s,u=.34*d,p=.2*s,f=.3*d,g=d3.line().x(function(t){return t.x>p?n(h):t.x<-p?n(-h):n(t.x)}).y(function(t){return t.y>f?i(u):t.y<-f?i(-u):i(t.y)}),v=d3.scaleLinear().range([2,18]).domain(d3.extent(a.data,function(t){return+t.radius}));n.domain([-h,h]),i.domain([-u,u]),this.container.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+this.height+")").call(d3.axisBottom(n).tickSize(-this.height).tickFormat(function(t){return t>p||t<-p?"":t})),this.container.append("g").attr("class","y-axis axis").call(d3.axisLeft(i).tickSize(-this.width).tickFormat(function(t){return t>f||t<-f?"":t})),this.container.append("rect").attr("class","around").attr("x",0).attr("y",0).attr("height",this.height).attr("width",this.width),this.container.append("line").attr("class","like-axis").attr("x1",0).attr("x2",this.width).attr("y1",i(0)).attr("y2",i(0)),this.container.append("line").attr("class","like-axis").attr("x1",n(0)).attr("x2",n(0)).attr("y1",0).attr("y2",this.height),this.container.append("text").attr("class","label-axis label-y-axis").attr("text-anchor","middle").attr("transform","translate("+(10-this.margin.left)+","+this.height/2+")rotate(-90)").text("Local Trend (% Change in # Employees)"),this.container.append("text").attr("class","label-axis label-x-axis").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-(10-this.margin.bottom))+")").text("National Trend (% Change in # Employees)"),this.container.append("text").attr("class","more-than-y-max").attr("y",8).attr("x",-28).text(">30%"),this.container.append("circle").attr("class","more-than-y-max").attr("cx",n(0)).attr("cy",12.5).attr("r",2),this.container.append("line").attr("class","more-than-y-max").attr("x1",n(0)-5).attr("x2",n(0)+5).attr("y1",15).attr("y2",5),this.container.append("line").attr("class","more-than-y-max").attr("x1",n(0)-5).attr("x2",n(0)+5).attr("y1",20).attr("y2",10),this.container.append("text").attr("class","less-than-y-min").attr("y",this.height).attr("x",-31).text("<-30%"),this.container.append("circle").attr("class","less-than-y-min").attr("cx",n(0)).attr("cy",this.height-12.5).attr("r",2),this.container.append("line").attr("class","less-than-y-min").attr("x1",n(0)-5).attr("x2",n(0)+5).attr("y1",this.height-10+5).attr("y2",this.height-10-5),this.container.append("line").attr("class","less-than-y-min").attr("x1",n(0)-5).attr("x2",n(0)+5).attr("y1",this.height-15+5).attr("y2",this.height-15-5),this.container.append("text").attr("class","more-than-x-max").attr("y",this.height+10).attr("x",this.width-26).text(">20%"),this.container.append("circle").attr("class","more-than-x-max").attr("cy",i(0)).attr("cx",this.width-12.5).attr("r",2),this.container.append("line").attr("class","more-than-x-max").attr("y1",i(0)-5).attr("y2",i(0)+5).attr("x1",this.width-10+5).attr("x2",this.width-10-5),this.container.append("line").attr("class","more-than-x-max").attr("y1",i(0)-5).attr("y2",i(0)+5).attr("x1",this.width-15+5).attr("x2",this.width-15-5),this.container.append("text").attr("class","less-than-x-min").attr("y",this.height+10).attr("x",0).text("<-20%"),this.container.append("circle").attr("class","less-than-x-min").attr("cy",i(0)).attr("cx",12.5).attr("r",2),this.container.append("line").attr("class","less-than-x-min").attr("y1",i(0)-5).attr("y2",i(0)+5).attr("x1",15).attr("x2",5),this.container.append("line").attr("class","less-than-x-min").attr("y1",i(0)-5).attr("y2",i(0)+5).attr("x1",20).attr("x2",10);this.container.append("text").attr("class","year label").attr("y",this.height-5).attr("x",this.width-5).text(this.year);var y=this.container.append("text").attr("class","description label").attr("y",-10).attr("x",0).text(""),b=(this.padding,this.container.selectAll(".bubble").data(a.data).enter().append("circle").attr("class","bubble").style("stroke","#565352").style("stroke-width","1").style("fill",function(t,e){return t.color}).attr("clip-path","url(#line-clip)").attr("cx",function(t){return t["National Trend"]>p?n(h):t["National Trend"]<-p?n(-h):n(t["National Trend"])}).attr("cy",function(t){return t["Local Trend"]>f?i(u):t["Local Trend"]<-f?i(-u):i(t["Local Trend"])}).attr("r",function(t){return v(t.radius)}).style("cursor","pointer").on("mouseover",function(t){b.style("opacity",1),d3.select(this).style("opacity",1);var n=e(t.Industry)||a.width+1;y.text(n<a.width?t.Industry:t.Industry.substring(0,65)+"..."),a.container.selectAll(".history").remove();var i=[];a.years.map(function(e){a.datas[e].map(function(e){t.Industry===e.Industry&&i.push({x:e["National Trend"],y:e["Local Trend"]})})}),a.container.append("path").data([i]).attr("clip-path","url(#line-clip)").classed("history background-history",!0).attr("d",g);var r=d3.transition().duration(1e3).ease(d3.easeLinear),o=a.container.selectAll(".animated-history").data([i]);o.enter().append("path").classed("history animated-history",!0).merge(o).attr("d",g).attr("clip-path","url(#line-clip)").attr("stroke-dasharray",function(t){return this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}),a.container.selectAll(".animated-history").transition(r).attr("stroke-dashoffset",0)}).on("mouseout",function(){y.text(""),t.container.selectAll(".history").remove(),b.style("opacity",1)}));this.container.append("line").attr("class","like-diagonal").attr("clip-path","url(#line-clip)").attr("x1",n(-h)).attr("x2",n(+h)).attr("y1",i(-u)).attr("y2",i(+u))}}]),t}(),TrendsTable=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.count=e.count,this.callback=e.callback,this.prepareData(e.data,e.colors),this.draw(),this.callback&&this.callback(this.bubbleObj)}return _createClass(t,[{key:"prepareData",value:function(t,e){var a=this.callback,n=d3.format(",");var i=[],r={},o={},s=0,l=(t.reduce(function(t,e,a){return t[e.naics]=e,t},{}),e.reduce(function(t,e,a){return t[e.Group]=e,t},{})),c=d3.keys(t[0]).filter(function(t){return-1!==t.indexOf("L_T_")}).map(function(t){return t=+t.replace(/[^-.0-9]+/g,""),r[t]=[],t}),d=c[c.length-1]+1;c.push(d),r[d]=[],c.sort(function(t,e){return t-e}),t.sort(function(t,e){return+e[2015]-+t[2015]}),t.map(function(t,e){var a,o={};c.map(function(e){o.year={},o.year=e==d?{color:l[t.Group].Hex||"gray",Industry:t.Label,"Local Trend":+t.Local_Trend||0,"National Trend":+t.Natl_Trend||0,radius:+t[2015],Employees:+t[2015],"Relative Size":+t.RS_2015,"Nat’l Trend":+t.Natl_Trend||0}:{color:l[t.Group].Hex||"gray",Industry:t.Label,"Local Trend":+t["L_T_"+e]||0,"National Trend":+t["N_T_"+e]||0,radius:+t[2015],Employees:+t[2015],"Relative Size":+t.RS_2015,"Nat’l Trend":+t.Natl_Trend||0},r[e].push(o.year)}),i.push({Industry:t.Label,Employees:(a=t[2015],n(+a||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend (2020)":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend (2020)":(100*+t.Natl_Trend).toFixed(2)+"%"})}),c.map(function(t){var e=r[t].slice(0,50),a=d3.min(e,function(t){return t["Local Trend"]}),n=d3.max(e,function(t){return t["Local Trend"]});s=Math.max(s,Math.max(Math.abs(a),Math.abs(n)))}),$("#trends-time").attr("min",c[0]).attr("max",c[c.length-1]).on("input change",function(){o.year=$(this).val(),o.yearLabel=o.year==d?"2020":o.year,a(o)}),o={bubbleByYear:r,years:c,year:c[0],yearLabel:c[0],absMaxX:.5,absMaxY:s},this.bubbleObj=o,this.count&&(i=i.slice(0,this.count)),this.data=i}},{key:"draw",value:function(){var t=!0,e=this.element,a=this.data,n=this.bubbleObj,i=this.callback;e.selectAll("*").remove(),e.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","trends-table-search").on("keyup",function(){var t=this.value.trim().toLowerCase(),e=0;c.each(function(a){var n=d3.select(this),i=-1!=a.Industry.toLowerCase().indexOf(t);n.style("background",e%2?"#fff":"#eee").style("display",i?"table-row":"none"),i&&e++})});var r=e.append("table"),o=d3.keys(a[0]).filter(function(t){return"bubbleByYear"!==t}),s=d3.select(".information-tooltip"),l=r.append("thead").append("tr").selectAll("th").data(o).enter().append("th").each(function(t){if("Relative Size"==t){var e=d3.select(this);e.append("span").text(t).style("white-space","nowrap"),e.append("img").attr("src","images/information.png").attr("alt","information").attr("class","information").on("mouseover",function(){var t=d3.select(this).node().getBoundingClientRect(),e=s.node(),a=$(e).outerWidth(!0),n=$(e).outerHeight(!0),i=$(window).width(),r=(d3.event.pageX||t.left)+10;r+a/2>i?r=i-a-10:r-=a/2;var o=(d3.event.pageY||t.top)-15-n;s.style("top",o+"px").style("left",r+"px"),s.style("visibility","visible")}).on("mouseout",function(){return s.style("visibility","hidden")})}else d3.select(this).text(t)}).on("click",function(e,a){l.attr("class","header"),t?(0===a?(c.sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0})})):(c.sort(function(t,a){return+t[e].replace(/[^-.0-9]+/g,"")-+a[e].replace(/[^-.0-9]+/g,"")}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return+(t[e]+"").replace(/[^-.0-9]+/g,"")-+(a[e]+"").replace(/[^-.0-9]+/g,"")})})),t=!1,this.className="aes"):(0===a?(c.sort(function(t,a){return a[e]<t[e]?-1:a[e]>t[e]?1:0}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return a[e]<t[e]?-1:a[e]>t[e]?1:0})})):(c.sort(function(t,a){return+a[e].replace(/[^-.0-9]+/g,"")-+t[e].replace(/[^-.0-9]+/g,"")}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return+(a[e]+"").replace(/[^-.0-9]+/g,"")-+(t[e]+"").replace(/[^-.0-9]+/g,"")})})),t=!0,this.className="des"),r.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"});var o=0;n.years.map(function(t){var e=n.bubbleByYear[t].slice(0,50),a=d3.min(e,function(t){return t["Local Trend"]}),i=d3.max(e,function(t){return t["Local Trend"]});o=Math.max(o,Math.max(Math.abs(a),Math.abs(i)))}),n.absMaxX=.5,n.absMaxY=o,i(n)}),c=r.append("tbody").selectAll("tr").data(a).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});c.selectAll("td").data(function(t){return o.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}}]),t}();