"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e,n){n.vibrant||(n.vibrant={}),n.loadActivity=function(n){!function(n,r){var o="Austin";function s(e){t.csv("./data/"+e+"_Master_Traded.csv",function(e,n){if(e)throw e;var a=[];n.map(function(t){var e;t["Relative Size (RS)"]=(+t["Relative Size (RS)"]).toFixed(2),t.Employees=(e=t.Employees,i(+e||0)||0),a.push({NAICS:t.naics,Description:t.Label,Employees:+t[2015],"Relative Size":(+t.RS_2015).toFixed(2),"% Total":(+t.Pct_Total).toFixed(0)+"%"})}),a.sort(function(t,e){return+e.Employees-+t.Employees});var r=!0,o=t.select("#activity-table-wrapper");o.selectAll("*").remove();var s=o.append("div");s.append("input").attr("placeholder","Search by Description...").attr("type","text").attr("id","activity-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),n=0;u.each(function(i){var a=t.select(this),r=-1!=i.Description.toLowerCase().indexOf(e);a.style("background",n%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&n++})});var l=o.append("table"),c=t.keys(a[0]),d=l.append("thead").append("tr").selectAll("th").data(c).enter().append("th").text(function(t){return t}).on("click",function(t,e){d.attr("class","header"),r?(1===e?u.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):u.sort(function(e,n){return+e[t].replace(/[^0-9]+/g,"")-+n[t].replace(/[^0-9]+/g,"")}),r=!1,this.className="aes"):(1===e?u.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):u.sort(function(e,n){return+n[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),r=!0,this.className="des"),l.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),u=l.append("tbody").selectAll("tr").data(a).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});u.selectAll("td").data(function(t){return c.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})})}function l(n){var i=e("#activity-bubble-wrapper").width()||960,r=e("#activity-bubble-wrapper").height()||430,o=12;t.text("./data/"+n+"_Bubbles.csv",function(e,n){if(e)throw e;var s="text,size,group\n"+n,l=t.csvParse(s);l.forEach(function(t){t.size=+t.size});var c=[];l.forEach(function(t){c.contains(t.group)||c.push(t.group)});for(var d=l.length,u=c.length,h=new Array(u),p=[],f=0;f<d;f++)p.push(g(l,f));function g(t,e){var n=c.indexOf(t[e].group),a=Math.sqrt((n+1)/u*-Math.log(Math.random()))*o,s={cluster:n,index:e,radius:.002*t[e].size,text:t[e].text,x:200*Math.cos(n/u*2*Math.PI)+i/2+Math.random(),y:200*Math.sin(n/u*2*Math.PI)+r/2+Math.random()};return(!h[n]||a>h[n].radius)&&(h[n]=s),s}new a({element:t.select("#activity-bubble-wrapper").node(),data:{nodes:p,links:[]}})})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){o=e(this).data("value"),e(".dropdown-value").text(o),e(".dropdown-hidden").toggleClass("visibility-visible"),l(o),s(o)}),function(){var e=t.select("#activity-bubble-legend div");e.selectAll("*").remove();var n=e.append("div").attr("class","activity-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,i){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){n.text(t.tooltip),n.style("visibility","visible")}).on("mousemove",function(){n.style("top",24*i+5+"px").style("right","40px")}).on("mouseout",function(){return n.style("visibility","hidden")})})}(),l(o),s(o),e.isFunction(r)&&r()}(0,n)};var i=t.format(",");Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1};var a=function(){function e(n){_classCallCheck(this,e),this.data=n.data,this.element=n.element,this.color=t.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]),this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400,this.margin={top:0,right:10,bottom:0,left:0},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=t.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var n=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=n.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=e.append("div").attr("class","item activity-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(e){var n=this,i=this.tooltip,a=t.forceSimulation().force("link",t.forceLink().id(function(t){return t.index})).force("collide",t.forceCollide(function(t){return t.radius+1}).iterations(12)).force("charge",t.forceManyBody().strength(-1)).force("center",t.forceCenter(this.width/2,this.height/2)).force("y",t.forceY(0)).force("x",t.forceX(0)),r=this.container.append("g").attr("class","links").selectAll("line").data(e.links).enter().append("line").attr("stroke","transparent"),o=this.container.append("g").attr("class","nodes").selectAll(".node").data(e.nodes).enter().append("g").attr("class","node"),s=this.padding;o.append("circle").attr("r",function(t){return t.radius||0}).style("fill",function(t){return n.color(t.cluster)}).style("cursor","pointer").on("mouseover",function(t){i.text(t.text),i.style("visibility","visible")}).on("mousemove",function(e){s.top<=0?i.style("top",e.y+"px").style("left",t.event.pageX-s.left+10+"px"):i.style("top",t.event.pageY-s.top-10+"px").style("left",t.event.pageX-s.left+10+"px")}).on("mouseout",function(){return i.style("visibility","hidden")}).call(t.drag().on("start",function(e){t.event.active||a.alphaTarget(.3).restart(),i.style("visibility","hidden"),e.fx=e.x,e.fy=e.y}).on("drag",function(e){e.fx=t.event.x,e.fy=t.event.y}).on("end",function(e){t.event.active||a.alphaTarget(0),i.style("visibility","visible"),e.fx=null,e.fy=null})),o.append("text").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){return t.text.split(" ")[0].length>t.radius/3?"":t.text.substring(0,t.radius/3)});a.nodes(e.nodes).on("tick",function(){r.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),o.select("circle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),o.select("text").attr("x",function(t){return t.x}).attr("y",function(t){return t.y})}),a.force("link").links(e.links)}}]),e}()}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadLocal=function(r){!function(r,o){var s="Austin";function l(r){t.queue(2).defer(t.csv,"./data/"+r+"_Master_Local.csv").await(function(r,o){if(r)throw r;var s=[];o.reduce(function(t,e,n){return t[e.naics]=e,t},{});o.sort(function(t,e){return+e[2015]-+t[2015]}),o.map(function(t,e){var n;s.push({Industry:t.Label,Employees:(n=t[2015],i(+n||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(+t.Local_Trend).toFixed(3)+"%","Natâ€™l Trend":(+t.Natl_Trend).toFixed(3)+"%"})}),function(e){var n=!0,i=t.select("#local-table-wrapper");i.selectAll("*").remove(),i.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","local-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),n=0;s.each(function(i){var a=t.select(this),r=-1!=i.Industry.toLowerCase().indexOf(e);a.style("background",n%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&n++})});var a=i.append("table"),r=t.keys(e[0]),o=a.append("thead").append("tr").selectAll("th").data(r).enter().append("th").text(function(t){return t}).on("click",function(t,e){o.attr("class","header"),n?(0===e?s.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):s.sort(function(e,n){return+(e[t]+"").replace(/[^0-9]+/g,"")-+(n[t]+"").replace(/[^0-9]+/g,"")}),n=!1,this.className="aes"):(0===e?s.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):s.sort(function(e,n){return+(n[t]+"").replace(/[^0-9]+/g,"")-+(e[t]+"").replace(/[^0-9]+/g,"")}),n=!0,this.className="des"),a.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=a.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return r.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(s),s.sort(function(t,e){return+e["Relative Size"]-+t["Relative Size"]}),l=s.splice(0,10).concat(s.splice(s.length-10,s.length)),c=new a({element:document.querySelector("#local-bubble-wrapper"),data:l}),e(n).on("resize",function(){return c.draw()});var l,c})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){s=e(this).data("value"),e(".dropdown-value").text(s),e(".dropdown-hidden").toggleClass("visibility-visible"),l(s)}),l(s),e.isFunction(o)&&o()}(0,r)};var i=t.format(",");var a=function(){function e(n){_classCallCheck(this,e),this.data=n.data,this.element=n.element,this.color=t.scaleOrdinal(t.schemeCategory20),this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400,this.margin={top:30,right:50,bottom:70,left:50},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=t.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var n=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=n.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=e.append("div").attr("class","item local-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(e){var n=this,i=this.tooltip,a=t.scaleBand().range([0,this.width]).padding(.1),r=t.scaleLinear().range([0,this.height]),o=t.scaleLinear().range([5,25]).domain(t.extent(e,function(t){return+t["Relative Size"]}));a.domain(e.map(function(t){return t.Industry})),r.domain([t.min(e,function(t){return-t["Relative Size"]}),t.max(e,function(t){return-t["Relative Size"]})]),this.container.append("line").style("stroke","#000").style("stroke-width","2px").attr("x1",0).attr("x2",this.width).attr("y1",r(-1)).attr("y2",r(-1)),this.container.append("text").attr("x",this.width+5).attr("y",r(-1)+4).text("RS = 1");var s=this.padding;this.container.selectAll(".bubble").data(e).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return n.color(e)}).attr("cy",function(t){return t["Relative Size"]>0?r(Math.min(0,-t["Relative Size"])):r(Math.min(0,-t["Relative Size"]))+Math.abs(r(t["Relative Size"])-r(0))}).attr("cx",function(t){return a(t.Industry)+a.bandwidth()/2}).attr("r",function(t,e){return o(t["Relative Size"])}).style("cursor","pointer").on("mouseover",function(t){i.html("<p>"+t.Industry+"</p><p>Relative Size: "+t["Relative Size"]+"</p><p>Employees: "+t.Employees+"</p>"),i.style("visibility","visible")}).on("mousemove",function(e){var n=e["Relative Size"]>0?r(Math.min(0,-e["Relative Size"])):r(Math.min(0,-e["Relative Size"]))+Math.abs(r(e["Relative Size"])-r(0));i.style("top",n+"px").style("left",t.event.pageX-s.left+10+"px")}).on("mouseout",function(){return i.style("visibility","hidden")})}}]),e}()}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadSwot=function(n){!function(n,i){var a="Austin",r={strengths:{caption:"#4472c4",thead:"#8ea9db",tbody:"#d9e1f2"},weaknesses:{caption:"#ffc000",thead:"#ffd966",tbody:"#fff2cc"},opportunities:{caption:"#70ad47",thead:"#a9d08e",tbody:"#e2efda"},threats:{caption:"#ff0000",thead:"#ff7c80",tbody:"#ffcccc"}};function o(e,n){t.csv("./data/"+e+"_SWOT_"+n+".csv",function(e,i){if(e)throw e;var a=!0,o=t.select("#swot-"+n+"-wrapper");o.selectAll("table").remove();var s=o.append("table"),l=t.keys(i[0]);s.append("caption").text(n.toUpperCase()).style("background",r[n].caption);var c=s.append("thead").append("tr").selectAll("th").data(l).enter().append("th").style("background",r[n].thead).text(function(t){return t}).on("click",function(t,e){c.attr("class","header"),a?(1===e?d.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):d.sort(function(e,n){return+e[t].replace(/[^0-9]+/g,"")-+n[t].replace(/[^0-9]+/g,"")}),a=!1,this.className="aes"):(1===e?d.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):d.sort(function(e,n){return+n[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),a=!0,this.className="des")}),d=s.append("tbody").selectAll("tr").data(i).enter().append("tr").style("background",r[n].tbody);d.selectAll("td").data(function(t){return l.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){a=e(this).data("value"),e(".dropdown-value").text(a),e(".dropdown-hidden").toggleClass("visibility-visible"),o(a,"strengths"),o(a,"weaknesses"),o(a,"opportunities"),o(a,"threats")}),o(a,"strengths"),o(a,"weaknesses"),o(a,"opportunities"),o(a,"threats"),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadTrends=function(r){!function(r,o){var s="Austin";function l(i,r,o){var s=new a({element:t.select("#trends-bubble-wrapper").node(),data:i[o],year:o,datas:i,years:r});e(n).on("resize",function(){return s.draw()})}function c(n){t.queue(2).defer(t.csv,"./data/"+n+"_Master_Traded.csv").await(function(n,a){if(n)throw n;var r=[],o={},s=(a.reduce(function(t,e,n){return t[e.naics]=e,t},{}),t.keys(a[0]).filter(function(t){return-1!==t.indexOf("L_T_")}).map(function(t){return t=+t.replace(/[^0-9]+/g,""),o[t]=[],t}));s.sort(function(t,e){return t-e}),a.sort(function(t,e){return+e[2015]-+t[2015]}),a.map(function(t,e){var n;r.push({Industry:t.Label,Employees:(n=t[2015],i(+n||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(+t.Local_Trend).toFixed(3)+"%","Natâ€™l Trend":(+t.Natl_Trend).toFixed(3)+"%"}),s.map(function(e){o[e].push({Industry:t.Label,"Local Trend":+t["L_T_"+e]||0,"National Trend":+t["N_T_"+e]||0,"Relative Size":+t.RS_2015})})}),r.sort(function(t,e){return+e.Employees-+t.Employees}),s.map(function(t){o[t]=o[t].splice(0,50)}),e("#trends-time").attr("min",s[0]).attr("max",s[s.length-1]).on("input change",function(){var t=e(this).val();l(o,s,t)}),function(e){var n=!0,i=t.select("#trends-table-wrapper");i.selectAll("*").remove(),i.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","trends-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),n=0;s.each(function(i){var a=t.select(this),r=-1!=i.Industry.toLowerCase().indexOf(e);a.style("background",n%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&n++})});var a=i.append("table"),r=t.keys(e[0]),o=a.append("thead").append("tr").selectAll("th").data(r).enter().append("th").text(function(t){return t}).on("click",function(t,e){o.attr("class","header"),n?(0===e?s.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):s.sort(function(e,n){return+e[t].replace(/[^0-9]+/g,"")-+n[t].replace(/[^0-9]+/g,"")}),n=!1,this.className="aes"):(0===e?s.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):s.sort(function(e,n){return+n[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),n=!0,this.className="des"),a.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=a.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return r.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(r),l(o,s,s[0])})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){s=e(this).data("value"),e(".dropdown-value").text(s),e(".dropdown-hidden").toggleClass("visibility-visible"),c(s)}),function(){var e=t.select("#trends-bubble-legend div");e.selectAll("*").remove();var n=e.append("div").attr("class","trends-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,i){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){n.text(t.tooltip),n.style("visibility","visible")}).on("mousemove",function(){n.style("top",24*i+5+"px").style("right","40px")}).on("mouseout",function(){return n.style("visibility","hidden")})})}(),c(s),e.isFunction(o)&&o()}(0,r)};var i=t.format(",");var a=function(){function e(n){_classCallCheck(this,e),this.data=n.data,this.year=n.year||"",this.datas=n.datas,this.years=n.years||"",this.element=n.element,this.color=t.scaleOrdinal(t.schemeCategory20),this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400;var e=Math.min(this.width,this.height);this.width=e,this.height=e,this.margin={top:40,right:40,bottom:40,left:40},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var n=t.select(this.element);n.selectAll(".item").remove(),this.padding=n.node().getBoundingClientRect();var i=n.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=i.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.createBubbles()}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(){var e=this,n=this,i=t.scaleLinear().range([0,this.width]),a=t.scaleLinear().range([this.height,0]),r=t.line().x(function(t){return i(t.x)}).y(function(t){return a(t.y)}),o=t.scaleLinear().range([2,18]).domain(t.extent(n.data,function(t){return+t["Relative Size"]})),s=t.min(n.data,function(t){return t["National Trend"]}),l=t.max(n.data,function(t){return t["National Trend"]}),c=Math.max(Math.abs(s),Math.abs(l));i.domain([-c,+c]);var d=t.min(n.data,function(t){return t["Local Trend"]}),u=t.max(n.data,function(t){return t["Local Trend"]}),h=Math.max(Math.abs(d),Math.abs(u));a.domain([-h,+h]);var p=Math.min(h,c);this.container.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+this.height+")").call(t.axisBottom(i).tickSize(-this.height)),this.container.append("g").attr("class","y-axis axis").call(t.axisLeft(a).tickSize(-this.width)),this.container.append("rect").attr("class","around").attr("x",0).attr("y",0).attr("height",this.height).attr("width",this.width),this.container.append("line").attr("class","like-axis").attr("x1",0).attr("x2",this.width).attr("y1",a(0)).attr("y2",a(0)),this.container.append("line").attr("class","like-axis").attr("x1",i(0)).attr("x2",i(0)).attr("y1",0).attr("y2",this.height),this.container.append("text").attr("class","label-axis label-y-axis").attr("text-anchor","middle").attr("transform","translate("+(15-this.margin.left)+","+this.height/2+")rotate(-90)").text("Local Trend (% Change in # Employees)"),this.container.append("text").attr("class","label-axis label-x-axis").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-(15-this.margin.bottom))+")").text("National Trend (% Change in # Employees)");this.container.append("text").attr("class","year label").attr("y",this.height-5).attr("x",this.width-5).text(this.year);var f=this.container.append("text").attr("class","description label").attr("y",-10).attr("x",0).text(""),g=(this.padding,this.container.selectAll(".bubble").data(n.data).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,n){return e.color(n)}).attr("cy",function(t){return a(t["Local Trend"])}).attr("cx",function(t){return i(t["National Trend"])}).attr("r",function(t){return o(t["Relative Size"])}).style("cursor","pointer").on("mouseover",function(e){g.style("opacity",1),t.select(this).style("opacity",1),f.text(e.Industry),n.container.select(".history").remove();var i=[];n.years.map(function(t){n.datas[t].map(function(t){e.Industry===t.Industry&&i.push({x:t["National Trend"],y:t["Local Trend"]})})});var a=t.transition().duration(2e3).ease(t.easeLinear),o=n.container.selectAll(".history").data([i]);o.enter().append("path").classed("history",!0).merge(o).attr("d",r).attr("stroke-dasharray",function(t){return this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}),n.container.selectAll(".history").transition(a).attr("stroke-dashoffset",0)}).on("mouseout",function(){f.text(""),e.container.select(".history").remove(),g.style("opacity",1)}));this.container.append("line").attr("class","like-diagonal").attr("x1",i(-p)).attr("x2",i(+p)).attr("y1",a(-p)).attr("y2",a(+p))}}]),e}()}(d3,$,window),$(function(){window.vibrant||(window.vibrant={});var t,e=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(t){8==t.which&&(!e.test(t.target.tagName)||t.target.disabled||t.target.readOnly)&&t.preventDefault()}),window.onpopstate=function(t){$(document).ready(function(){i(!0),loadPage({},!0)})},$(document).ready(function(){t=$("#loading-wrapper"),i(!0),$("#navigation .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");loadPage({page:e})}),loadPage({},!0)});var n={activity:{page:"activity",nav:"graphs",event:window.loadActivity,nextAjax:function(){t.addClass("hidden")}},trends:{page:"trends",nav:"graphs",event:window.loadTrends,nextAjax:function(){t.addClass("hidden")}},local:{page:"local",nav:"graphs",event:window.loadLocal,nextAjax:function(){t.addClass("hidden")}},swot:{page:"swot",nav:"graphs",event:window.loadSwot,nextAjax:function(){t.addClass("hidden")}}};function i(t){var e=$("#header").height();$("#container").css("margin-top",e),$("#page-wrapper").css("min-height",$(window).height()-e)}window.loadPage=function e(a,r){var o=a.page||function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("page",window.location.search)||"activity";"nolink"!==o&&(t.removeClass("hidden"),o=o.replace("#","").replace(/[^a-zA-Z]+/g,""),n[o]?o&&(window.history.pushState({page:o},o,"?page="+o),"graphs"===n[o].nav&&r&&($("#navigation .link-to").removeClass("link-to-active"),$("#navigation .link-to-"+n[o].nav).addClass("link-to-active"),$("#sub-navigation-wrapper").empty().load("graphs_nav.html",function(t){$("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+o).addClass("link-to-active"),$("#sub-navigation-wrapper .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var n=$(this).data("link-to");"nolink"!==n&&($("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+n).addClass("link-to-active"),e({page:n}))}),i(!1)})),$("#page-wrapper").empty().load(n[o].page+".html",function(t){$.isFunction(n[o].callback)&&n[o].callback(),$.isFunction(n[o].prevAjax)&&n[o].prevAjax(),$.isFunction(n[o].event)&&n[o].event(n[o].nextAjax)})):window.open(window.location.origin+"?page=activity","_self"))},$(window).on("resize",i)});