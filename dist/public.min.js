"use strict";var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var ActivityBubble=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.color=d3.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]),this.prepareData(e.data,e.colors),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t,e){Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1};var a=e.reduce(function(t,e,a){return t[e.Group]=e,t},{}),n=$("#activity-bubble-wrapper").width()||960,i=$("#activity-bubble-wrapper").height()||550,r=12,s=[];t.map(function(t){s.push({text:t.Label,size:+t[2015],group:t.Group})});var o=[];s.forEach(function(t){o.contains(t.group)||o.push(t.group)});for(var l=s.length,c=o.length,d=new Array(c),u=[],h=0;h<l;h++)u.push(p(s,h));function p(t,e){var s=o.indexOf(t[e].group),l=Math.sqrt((s+1)/c*-Math.log(Math.random()))*r,u={color:a[s].Hex,cluster:s,index:e,radius:.002*t[e].size,text:t[e].text,x:200*Math.cos(s/c*2*Math.PI)+n/2+Math.random(),y:200*Math.sin(s/c*2*Math.PI)+i/2+Math.random()};return(!d[s]||l>d[s].radius)&&(d[s]=u),u}this.graph={nodes:u,links:[]}}},{key:"draw",value:function(){var t=this.element,e=t.node();this.padding=e.getBoundingClientRect(),t.selectAll(".item").remove(),this.width=e.offsetWidth||400,this.height=e.offsetHeight||400,this.margin={top:0,right:10,bottom:0,left:0},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var a=t.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=t.append("div").attr("class","item activity-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.graph)}},{key:"setData",value:function(t){this.graph=t,this.draw()}},{key:"createBubbles",value:function(t){var e=this,a=this,n=d3.forceSimulation().force("link",d3.forceLink().id(function(t){return t.index})).force("collide",d3.forceCollide(function(t){return t.radius+1}).iterations(12)).force("charge",d3.forceManyBody().strength(-1)).force("center",d3.forceCenter(this.width/2,this.height/2)).force("y",d3.forceY(0)).force("x",d3.forceX(0)),i=this.container.append("g").attr("class","links").selectAll("line").data(t.links).enter().append("line").attr("stroke","transparent"),r=this.container.append("g").attr("class","nodes").selectAll(".node").data(t.nodes).enter().append("g").attr("class","node"),s=this.padding;r.append("circle").attr("r",function(t){return t.radius||0}).style("fill",function(t){return e.color(t.cluster)||t.color}).style("cursor","pointer").on("mouseover",function(t){a.tooltip.text(t.text),a.tooltip.style("visibility","visible")}).on("mousemove",function(t){a.tooltip.style("top",t.y+"px").style("left",d3.event.pageX-s.left+10+"px")}).on("mouseout",function(){return a.tooltip.style("visibility","hidden")}).call(d3.drag().on("start",function(t){d3.event.active||n.alphaTarget(.3).restart(),a.tooltip.style("visibility","hidden"),t.fx=t.x,t.fy=t.y}).on("drag",function(t){t.fx=d3.event.x,t.fy=d3.event.y}).on("end",function(t){d3.event.active||n.alphaTarget(0),a.tooltip.style("visibility","visible"),t.fx=null,t.fy=null})),r.append("text").attr("class","first-row").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){t.secondRow="";var e=t.text.trim().split(" ");return e[3]&&e[2]&&e[1]&&e[0].length+1+e[1].length+1+e[2].length+1+e[3].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>3&&(t.secondRow=t.secondRow+" "+e)}),e[0]+" "+e[1]+" "+e[2]+" "+e[3]):e[2]&&e[1]&&e[0].length+1+e[1].length+1+e[2].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>2&&(t.secondRow=t.secondRow+" "+e)}),e[0]+" "+e[1]+" "+e[2]):e[1]&&e[0].length+1+e[1].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>1&&(t.secondRow=t.secondRow+" "+e)}),e[0]+" "+e[1]):e[0].length<t.radius/3?(t.isFirstRow=!0,e.map(function(e,a){a>=1&&(t.secondRow=t.secondRow+" "+e)}),e[0]):(t.isFirstRow=!1,"")}),r.append("text").attr("class","second-row").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){var e=t.secondRow.trim().split(" ");return 1===e.length&&""===e[0]?(t.isSecondRow=!1,""):t.isFirstRow&&e[2]&&e[1]&&e[0].length+1+e[1].length+1+e[2].length<t.radius/3?(t.isSecondRow=!0,e[0]+" "+e[1]+" "+e[2]):t.isFirstRow&&e[1]&&e[0].length+1+e[1].length<t.radius/3?(t.isSecondRow=!0,e[0]+" "+e[1]):t.isFirstRow&&e[0].length<t.radius/3?(t.isSecondRow=!0,e[0]):(t.isSecondRow=!1,"")});n.nodes(t.nodes).on("tick",function(){r.each(function(t){var e=d3.select(this);t.x=Math.max(t.radius,Math.min(a.width-t.radius,t.x)),t.y=Math.max(t.radius,Math.min(a.height-t.radius,t.y)),e.select("circle").attr("cx",t.x).attr("cy",t.y),e.select(".first-row").attr("x",t.x).attr("y",t.isSecondRow?t.y-6:t.y),e.select(".second-row").attr("x",t.x).attr("y",t.isSecondRow?t.y+6:t.y)}),i.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})}),n.force("link").links(t.links)}}]),t}(),ActivityTable=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.count=e.count,this.prepareData(e.data),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t){var e=d3.format(",");function a(t){return e(+t||0)||0}var n=[];t.map(function(t){t["Relative Size (RS)"]=(+t["Relative Size (RS)"]).toFixed(2),t.Employees=a(t.Employees),n.push({NAICS:t.naics,Description:t.Label,Employees:a(+t[2015]),"Relative Size":(+t.RS_2015).toFixed(2),"% Total":(100*+t.Pct_Total).toFixed(2)+"%"})}),n.sort(function(t,e){return+e.Employees.replace(/[^-.0-9]+/g,"")-+t.Employees.replace(/[^-.0-9]+/g,"")}),this.count&&(n=n.slice(0,this.count)),this.data=n}},{key:"draw",value:function(){var t=this.element,e=this.data,a=!0;t.selectAll("*").remove(),t.append("div").append("input").attr("placeholder","Search by Description...").attr("type","text").attr("id","activity-table-search").on("keyup",function(){var t=this.value.trim().toLowerCase(),e=0;s.each(function(a){var n=d3.select(this),i=-1!=a.Description.toLowerCase().indexOf(t);n.style("background",e%2?"#fff":"#eee").style("display",i?"table-row":"none"),i&&e++})});var n=t.append("table"),i=d3.keys(e[0]),r=n.append("thead").append("tr").selectAll("th").data(i).enter().append("th").text(function(t){return t}).on("click",function(t,e){r.attr("class","header"),a?(1===e?s.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):s.sort(function(e,a){return+e[t].replace(/[^-.0-9]+/g,"")-+a[t].replace(/[^-.0-9]+/g,"")}),a=!1,this.className="aes"):(1===e?s.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):s.sort(function(e,a){return+a[t].replace(/[^-.0-9]+/g,"")-+e[t].replace(/[^-.0-9]+/g,"")}),a=!0,this.className="des"),n.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=n.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return i.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}}]),t}(),BubbleLegend=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.class=e.class,this.draw()}return _createClass(t,[{key:"draw",value:function(){var t=this;t.element.selectAll("*").remove();var e=t.element.append("div").attr("class",t.class).style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(a,n){t.element.append("img").attr("src","img dump/"+a.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){e.text(a.tooltip),e.style("visibility","visible")}).on("mousemove",function(){e.style("top",24*n+5+"px").style("right","40px")}).on("mouseout",function(){return e.style("visibility","hidden")})})}}]),t}();!function(t,e,a){a.vibrant||(a.vibrant={}),a.loadActivity=function(a){!function(a,n){var i="Austin";function r(e){t.queue(2).defer(t.csv,"./data/"+e+"_Master_Traded.csv").defer(t.csv,"./data/color_legend2.csv").await(function(e,a,n){if(e)throw e;var i,r,s;i=a,r=n,new ActivityBubble({element:t.select("#activity-bubble-wrapper"),data:i,colors:r}),s=a,new ActivityTable({element:t.select("#activity-table-wrapper"),data:s,count:void 0})})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){i=e(this).data("value"),e(".dropdown-value").text(i),e(".dropdown-hidden").toggleClass("visibility-visible"),r(i)}),new BubbleLegend({element:t.select("#activity-bubble-legend div"),class:"activity-bubble-legend-tooltip"}),r(i),e.isFunction(n)&&n()}(0,a)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadLanding=function(n){!function(n,i){t.queue(2).defer(t.json,"./data/cities.json").await(function(n,i){if(n)throw n;var r=t.select("#cities-img-wrapper");r.selectAll("*").remove(),i.map(function(n){var i=r.append("div").attr("class","city-img-wrapper"),s=i.append("div").attr("class","city-img").on("click",function(){var i,r,s,o,l,c;e("#landing-content").removeClass("hidden"),e(".city").text(n.city),e("#under-counties-text").text(n.underCountiesText),t.select("#counties-img").attr("src","./img/Counties_"+n.city+".gif"),c=n.city,o=c,new BubbleLegend({element:t.select("#activity-bubble-legend div"),class:"activity-bubble-legend-tooltip"}),l=o,t.queue(2).defer(t.csv,"./data/"+l+"_Master_Traded.csv").defer(t.csv,"./data/color_legend2.csv").await(function(e,a,n){if(e)throw e;var i,r,s;i=a,r=n,new ActivityBubble({element:t.select("#activity-bubble-wrapper"),data:i,colors:r}),s=a,new ActivityTable({element:t.select("#activity-table-wrapper"),data:s,count:25})}),function(n){function i(n,i){new TrendsTable({element:t.select("#trends-table-wrapper"),data:n,colors:i,count:25,callback:function(n){var i,r,s;r=(i=n).bubbleByYear[i.year].slice(0,50),s=new TrendsBubble({element:t.select("#trends-bubble-wrapper").node(),data:r,year:i.yearLabel,datas:i.bubbleByYear,years:i.years,absMaxX:i.absMaxX,absMaxY:i.absMaxY}),e(a).on("resize",function(){return s.draw()})}})}var r;new BubbleLegend({element:t.select("#trends-bubble-legend div"),class:"trends-bubble-legend-tooltip"}),r=n,t.queue(2).defer(t.csv,"./data/"+r+"_Master_Traded.csv").defer(t.csv,"./data/color_legend.csv").await(function(t,e,a){if(t)throw t;i(e,a)})}(c),r=c,new BubbleLegend({element:t.select("#local-bubble-legend div"),class:"local-bubble-legend-tooltip"}),s=r,t.queue(2).defer(t.csv,"./data/"+s+"_Master_Local.csv").defer(t.csv,"./data/color_legend.csv").await(function(n,i,r){if(n)throw n;var s,o,l,c,d;s=i,o=r,new LocalTable({element:t.select("#local-table-wrapper"),data:s,colors:o,count:25}),l=i,c=r,d=new LocalBubble({element:t.select("#local-bubble-wrapper"),data:l,colors:c}),e(a).on("resize",function(){return d.draw()})}),new swotTable({activeCity:i=c,type:"strengths"}),new swotTable({activeCity:i,type:"weaknesses"}),new swotTable({activeCity:i,type:"opportunities"}),new swotTable({activeCity:i,type:"threats"}),function(n){e("#local-view").off().on("click",function(){s(n)}),e("#national-view").off().on("click",function(){s("national")}),new BubbleLegend({element:t.select("#network-bubble-legend div"),class:"network-bubble-legend-tooltip"});var i=e("#header").outerHeight(!0)+e("#footer").outerHeight(!0),r=e(a).height()-i;function s(n){var i=t.select("#network-wrapper");i.selectAll("*").remove(),e(a),i.append("iframe").attr("width",Math.floor(e("#landing-network-wrapper").width()||e(a).width())||"100%").attr("height",Math.floor(r)+"px").attr("src",n.toLowerCase()+".html")}s(n)}(c)});s.append("img").attr("src","./img/"+n.city.toLowerCase()+".jpg"),s.append("p").text(n.city+", "+n.state)})}),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadLocal=function(n){!function(n,i){var r="Austin";function s(n){t.queue(2).defer(t.csv,"./data/"+n+"_Master_Local.csv").defer(t.csv,"./data/color_legend.csv").await(function(n,i,r){if(n)throw n;var s,o,l,c,d;s=i,o=r,new LocalTable({element:t.select("#local-table-wrapper"),data:s,colors:o,count:void 0}),l=i,c=r,d=new LocalBubble({element:t.select("#local-bubble-wrapper"),data:l,colors:c}),e(a).on("resize",function(){return d.draw()})})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),s(r)}),new BubbleLegend({element:t.select("#local-bubble-legend div"),class:"local-bubble-legend-tooltip"}),s(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadNetwork=function(n){!function(n,i){var r="National";e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),l(r)});var s=e("#header").outerHeight(!0)+e("#footer").outerHeight(!0),o=e(a).height()-s;function l(n){var i=t.select("#network-wrapper");i.selectAll("*").remove();e(a);i.append("iframe").attr("width",Math.floor(e(a).width())||"100%").attr("height",Math.floor(o)+"px").attr("src",n.toLowerCase()+".html")}e("#page-wrapper").addClass("no-min-height").css("height",o),new BubbleLegend({element:t.select("#network-bubble-legend div"),class:"network-bubble-legend-tooltip"}),l(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadSwot=function(t){!function(t,a){var n="Austin";function i(t){new swotTable({activeCity:t,type:"strengths"}),new swotTable({activeCity:t,type:"weaknesses"}),new swotTable({activeCity:t,type:"opportunities"}),new swotTable({activeCity:t,type:"threats"})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){n=e(this).data("value"),e(".dropdown-value").text(n),e(".dropdown-hidden").toggleClass("visibility-visible"),i(n)}),i(n),e.isFunction(a)&&a()}(0,t)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadTrends=function(n){!function(n,i){var r="Austin";function s(n,i){new TrendsTable({element:t.select("#trends-table-wrapper"),data:n,colors:i,count:void 0,callback:function(n){var i,r,s;r=(i=n).bubbleByYear[i.year].slice(0,50),s=new TrendsBubble({element:t.select("#trends-bubble-wrapper").node(),data:r,year:i.yearLabel,datas:i.bubbleByYear,years:i.years,absMaxX:i.absMaxX,absMaxY:i.absMaxY}),e(a).on("resize",function(){return s.draw()})}})}function o(e){t.queue(2).defer(t.csv,"./data/"+e+"_Master_Traded.csv").defer(t.csv,"./data/color_legend.csv").await(function(t,e,a){if(t)throw t;s(e,a)})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),o(r)}),new BubbleLegend({element:t.select("#trends-bubble-legend div"),class:"trends-bubble-legend-tooltip"}),o(r),e.isFunction(i)&&i()}(0,n)}}(d3,$,window);var LocalBubble=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.prepareData(e.data,e.colors),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t,e){var a=d3.format(",");var n=[],i=(t.reduce(function(t,e,a){return t[e.naics]=e,t},{}),e.reduce(function(t,e,a){return t[e.Group]=e,t},{}));t.sort(function(t,e){return+e[2015]-+t[2015]}),t.map(function(t,e){var r;n.push({color:i[t.Group].Hex||"gray",Industry:t.Label,Employees:(r=t[2015],a(+r||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),n.sort(function(t,e){return+e["Relative Size"]-+t["Relative Size"]});var r=n.splice(0,10).concat(n.splice(n.length-10,n.length));this.data=r}},{key:"draw",value:function(){var t=this.element,e=t.node();this.padding=e.getBoundingClientRect(),t.selectAll(".item").remove(),this.width=e.offsetWidth||400,this.height=e.offsetHeight||400,this.margin={top:30,right:100,bottom:70,left:100},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var a=t.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=t.append("div").attr("class","item local-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(t){var e=this.tooltip,a=d3.scaleBand().range([0,this.width]).padding(.1),n=d3.scaleLinear().range([0,this.height]),i=d3.scaleLinear().range([5,25]).domain(d3.extent(t,function(t){return+t.Employees.replace(/[^-.0-9]+/g,"")}));a.domain(t.map(function(t){return t.Industry})),n.domain([d3.min(t,function(t){return-t["Relative Size"]}),d3.max(t,function(t){return-t["Relative Size"]})]),this.container.append("line").style("stroke","#000").style("stroke-width","2px").attr("x1",0).attr("x2",this.width).attr("y1",n(-1)).attr("y2",n(-1)),this.container.append("text").attr("x",this.width+5).attr("y",n(-1)+4).text("RS = 1");var r=this.padding;this.container.selectAll(".bubble").data(t).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return t.color}).attr("cy",function(t){return t["Relative Size"]>0?n(Math.min(0,-t["Relative Size"])):n(Math.min(0,-t["Relative Size"]))+Math.abs(n(t["Relative Size"])-n(0))}).attr("cx",function(t){return a(t.Industry)+a.bandwidth()/2}).attr("r",function(t,e){return i(t.Employees.replace(/[^-0-9#]+/g,""))}).style("cursor","pointer").on("mouseover",function(t){e.html("<p>"+t.Industry+"</p><p>Relative Size: "+t["Relative Size"]+"</p><p>Employees: "+t.Employees+"</p>"),e.style("visibility","visible")}).on("mousemove",function(t){var a=t["Relative Size"]>0?n(Math.min(0,-t["Relative Size"])):n(Math.min(0,-t["Relative Size"]))+Math.abs(n(t["Relative Size"])-n(0));e.style("top",a+"px").style("left",d3.event.pageX-r.left+10+"px")}).on("mouseout",function(){return e.style("visibility","hidden")})}}]),t}(),LocalTable=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.count=e.count,this.prepareData(e.data,e.colors),this.draw()}return _createClass(t,[{key:"prepareData",value:function(t,e){var a=d3.format(",");var n=[],i=(t.reduce(function(t,e,a){return t[e.naics]=e,t},{}),e.reduce(function(t,e,a){return t[e.Group]=e,t},{}));t.sort(function(t,e){return+e[2015]-+t[2015]}),t.map(function(t,e){var r;n.push({color:i[t.Group].Hex||"gray",Industry:t.Label,Employees:(r=t[2015],a(+r||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),this.count&&(n=n.slice(0,this.count)),this.data=n}},{key:"draw",value:function(){var t=this.element,e=this.data,a=!0;t.selectAll("*").remove(),t.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","local-table-search").on("keyup",function(){var t=this.value.trim().toLowerCase(),e=0;s.each(function(a){var n=d3.select(this),i=-1!=a.Industry.toLowerCase().indexOf(t);n.style("background",e%2?"#fff":"#eee").style("display",i?"table-row":"none"),i&&e++})});var n=t.append("table"),i=d3.keys(e[0]).filter(function(t){return"color"!==t}),r=n.append("thead").append("tr").selectAll("th").data(i).enter().append("th").text(function(t){return t}).on("click",function(t,e){r.attr("class","header"),a?(0===e?s.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):s.sort(function(e,a){return+(e[t]+"").replace(/[^-.0-9]+/g,"")-+(a[t]+"").replace(/[^-.0-9]+/g,"")}),a=!1,this.className="aes"):(0===e?s.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):s.sort(function(e,a){return+(a[t]+"").replace(/[^-.0-9]+/g,"")-+(e[t]+"").replace(/[^-.0-9]+/g,"")}),a=!0,this.className="des"),n.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=n.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return i.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}}]),t}();$(function(){window.vibrant||(window.vibrant={});var t,e=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(t){8==t.which&&(!e.test(t.target.tagName)||t.target.disabled||t.target.readOnly)&&t.preventDefault()}),window.onpopstate=function(t){$(document).ready(function(){n(!0),loadPage({},!0)})},$(document).ready(function(){t=$("#loading-wrapper"),n(!0),$("#navigation .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");loadPage({page:e})}),loadPage({},!0)});var a={landing:{page:"landing",nav:void 0,event:window.loadLanding,prevAjax:function(){$("#sub-navigation").addClass("hidden"),$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#container").css("margin-top","50px"),t.addClass("hidden")},nextAjax:void 0},activity:{page:"activity",nav:"graphs",event:window.loadActivity,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){t.addClass("hidden")}},trends:{page:"trends",nav:"graphs",event:window.loadTrends,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){t.addClass("hidden")}},local:{page:"local",nav:"graphs",event:window.loadLocal,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){t.addClass("hidden")}},swot:{page:"swot",nav:"graphs",event:window.loadSwot,prevAjax:function(){$("#page-wrapper").css("height","inherit").removeClass("no-min-height"),$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){t.addClass("hidden")}},network:{page:"network",nav:"graphs",event:window.loadNetwork,prevAjax:function(){$("#sub-navigation").removeClass("hidden"),$("#container").css("margin-top","78px")},nextAjax:function(){t.addClass("hidden")}}};function n(t){var e=$("#header").height(),a=$(window).height()-e+"px";$("#container").css("margin-top",e),$("#page-wrapper").css("min-height",a).css("height","inherit")}$("#sub-navigation-wrapper .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");"nolink"!==e&&($("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+e).addClass("link-to-active"),loadPage({page:e}))}),n(!1),window.loadPage=function(e,i){var r=e.page||function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}("page",window.location.search)||"landing";"nolink"!==r&&(t.removeClass("hidden"),r=r.replace("#","").replace(/[^a-zA-Z]+/g,""),a[r]?r&&(window.history.pushState({page:r},r,"?page="+r),$("#navigation .link-to").removeClass("link-to-active"),$("#navigation .link-to-"+a[r].nav).addClass("link-to-active"),$("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+r).addClass("link-to-active"),i&&n(!1),$("#page-wrapper").empty().load(a[r].page+".html",function(t){$.isFunction(a[r].prevAjax)&&a[r].prevAjax(),$.isFunction(a[r].event)&&a[r].event(a[r].nextAjax)})):window.open(window.location.origin+"?page=","_self"))},$(window).on("resize",n)});var swotTable=function(){function t(e){_classCallCheck(this,t),this.type=e.type,this.activeCity=e.activeCity,this.color={strengths:{caption:"#4472c4",thead:"#8ea9db",tbody:"#d9e1f2"},weaknesses:{caption:"#ffc000",thead:"#ffd966",tbody:"#fff2cc"},opportunities:{caption:"#70ad47",thead:"#a9d08e",tbody:"#e2efda"},threats:{caption:"#ff0000",thead:"#ff7c80",tbody:"#ffcccc"}},this.draw()}return _createClass(t,[{key:"draw",value:function(){var t=this.activeCity,e=this.type,a=this.color;d3.csv("./data/"+t+"_SWOT_"+e+".csv",function(t,n){if(t)throw t;var i=!0,r=d3.select("#swot-"+e+"-wrapper");r.selectAll("table").remove();var s=r.append("table"),o=d3.keys(n[0]);s.append("caption").text(e.toUpperCase()).style("background",a[e].caption);var l=s.append("thead").append("tr").selectAll("th").data(o).enter().append("th").style("background",a[e].thead).text(function(t){return t}).on("click",function(t,e){l.attr("class","header"),i?(1===e?c.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):c.sort(function(e,a){return+e[t].replace(/[^-.0-9]+/g,"")-+a[t].replace(/[^-.0-9]+/g,"")}),i=!1,this.className="aes"):(1===e?c.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):c.sort(function(e,a){return+a[t].replace(/[^-.0-9]+/g,"")-+e[t].replace(/[^-.0-9]+/g,"")}),i=!0,this.className="des")}),c=s.append("tbody").selectAll("tr").data(n).enter().append("tr").style("background",a[e].tbody);c.selectAll("td").data(function(t){return o.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})})}}]),t}(),TrendsBubble=function(){function t(e){_classCallCheck(this,t),this.data=e.data,this.year=e.year||"",this.datas=e.datas,this.years=e.years||"",this.absMaxX=e.absMaxX||0,this.absMaxY=e.absMaxY||0,this.element=e.element,this.draw()}return _createClass(t,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400;var t=Math.min(this.width,this.height);this.width=t,this.height=t,this.margin={top:40,right:40,bottom:40,left:40},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=d3.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var a=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.clip=a.append("defs").append("clipPath").attr("id","line-clip").append("rect").attr("width",this.width).attr("height",this.height),this.createBubbles()}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(){var t=this;function e(t,a){var n=(e.canvas||(e.canvas=document.createElement("canvas"))).getContext("2d");return n.font=a||'24px "Helvetica Neue"',n.measureText(t).width}var a=1.6,n=this,i=d3.scaleLinear().range([0,this.width]),r=d3.scaleLinear().range([this.height,0]),s=d3.line().x(function(t){return i(t.x)}).y(function(t){return t.y>a?r(a):t.y<-a?r(-a):r(t.y)}),o=d3.scaleLinear().range([2,18]).domain(d3.extent(n.data,function(t){return+t.radius}));i.domain([-this.absMaxX,+this.absMaxX]),this.absMaxY>1.5?r.domain([-1.6,1.6]):r.domain([-this.absMaxY,this.absMaxY]);var l=Math.min(this.absMaxY,this.absMaxX);2020==this.year&&(i.domain([-.1*this.absMaxX,.1*this.absMaxX]),this.absMaxY>1.5?(r.domain([-.48,.48]),l=Math.min(.48,.1*this.absMaxX)):(r.domain([-.3*this.absMaxY,.3*this.absMaxY]),l=Math.min(.3*this.absMaxY,.1*this.absMaxX))),this.container.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+this.height+")").call(d3.axisBottom(i).tickSize(-this.height).tickFormat(function(t){return 100*t+"%"})),this.container.append("g").attr("class","y-axis axis").call(d3.axisLeft(r).tickSize(-this.width).tickFormat(function(t){return 100*t+"%"})),this.container.append("rect").attr("class","around").attr("x",0).attr("y",0).attr("height",this.height).attr("width",this.width),this.container.append("line").attr("class","like-axis").attr("x1",0).attr("x2",this.width).attr("y1",r(0)).attr("y2",r(0)),this.container.append("line").attr("class","like-axis").attr("x1",i(0)).attr("x2",i(0)).attr("y1",0).attr("y2",this.height),this.container.append("text").attr("class","label-axis label-y-axis").attr("text-anchor","middle").attr("transform","translate("+(10-this.margin.left)+","+this.height/2+")rotate(-90)").text("Local Trend (% Change in # Employees)"),this.container.append("text").attr("class","label-axis label-x-axis").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-(10-this.margin.bottom))+")").text("National Trend (% Change in # Employees)"),this.absMaxY>1.5&&2020!=this.year&&(this.container.append("text").attr("class","more-than-y-max").attr("y",5).attr("x",-33.5).text(">150%"),this.container.append("circle").attr("class","more-than-y-max").style("fill","#fff").style("stroke-width","0").attr("cx",i(0)).attr("cy",r(1.52)).attr("r",2),this.container.append("line").attr("class","more-than-y-max").attr("x1",i(-.02)).attr("x2",i(.02)).attr("y1",r(1.47)).attr("y2",r(1.53)),this.container.append("line").attr("class","more-than-y-max").attr("x1",i(-.02)).attr("x2",i(.02)).attr("y1",r(1.51)).attr("y2",r(1.57)));this.container.append("text").attr("class","year label").attr("y",this.height-5).attr("x",this.width-5).text(this.year);var c=this.container.append("text").attr("class","description label").attr("y",-10).attr("x",0).text(""),d=(this.padding,this.container.selectAll(".bubble").data(n.data).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return t.color}).attr("cy",function(t){return t["Local Trend"]>a?r(a):t["Local Trend"]<-a?r(-a):r(t["Local Trend"])}).attr("cx",function(t){return i(t["National Trend"])}).attr("r",function(t){return o(t.radius)}).style("cursor","pointer").on("mouseover",function(t){d.style("opacity",1),d3.select(this).style("opacity",1);var a=e(t.Industry)||n.width+1;c.text(a<n.width?t.Industry:t.Industry.substring(0,38)+"..."),n.container.selectAll(".history").remove();var i=[];n.years.map(function(e){n.datas[e].map(function(e){t.Industry===e.Industry&&i.push({x:e["National Trend"],y:e["Local Trend"]})})}),n.container.append("path").data([i]).attr("clip-path","url(#line-clip)").classed("history background-history",!0).attr("d",s);var r=d3.transition().duration(1e3).ease(d3.easeLinear),o=n.container.selectAll(".animated-history").data([i]);o.enter().append("path").classed("history animated-history",!0).merge(o).attr("d",s).attr("clip-path","url(#line-clip)").attr("stroke-dasharray",function(t){return this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}),n.container.selectAll(".animated-history").transition(r).attr("stroke-dashoffset",0)}).on("mouseout",function(){c.text(""),t.container.selectAll(".history").remove(),d.style("opacity",1)}));this.container.append("line").attr("class","like-diagonal").attr("x1",i(-l)).attr("x2",i(+l)).attr("y1",r(-l)).attr("y2",r(+l))}}]),t}(),TrendsTable=function(){function t(e){_classCallCheck(this,t),this.element=e.element,this.count=e.count,this.callback=e.callback,this.prepareData(e.data,e.colors),this.draw(),this.callback&&this.callback(this.bubbleObj)}return _createClass(t,[{key:"prepareData",value:function(t,e){var a=this.callback,n=d3.format(",");var i=[],r={},s={},o=0,l=(t.reduce(function(t,e,a){return t[e.naics]=e,t},{}),e.reduce(function(t,e,a){return t[e.Group]=e,t},{})),c=d3.keys(t[0]).filter(function(t){return-1!==t.indexOf("L_T_")}).map(function(t){return t=+t.replace(/[^-.0-9]+/g,""),r[t]=[],t}),d=c[c.length-1]+1;c.push(d),r[d]=[],c.sort(function(t,e){return t-e}),t.sort(function(t,e){return+e[2015]-+t[2015]}),t.map(function(t,e){var a,s={};c.map(function(e){s.year={},s.year=e==d?{color:l[t.Group].Hex||"gray",Industry:t.Label,"Local Trend":+t.Local_Trend||0,"National Trend":+t.Natl_Trend||0,radius:+t[2020],Employees:+t[2015],"Relative Size":+t.RS_2015,"Nat’l Trend":+t.Natl_Trend||0}:{color:l[t.Group].Hex||"gray",Industry:t.Label,"Local Trend":+t["L_T_"+e]||0,"National Trend":+t["N_T_"+e]||0,radius:+t[2020],Employees:+t[2015],"Relative Size":+t.RS_2015,"Nat’l Trend":+t.Natl_Trend||0},r[e].push(s.year)}),i.push({Industry:t.Label,Employees:(a=t[2015],n(+a||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),c.map(function(t){var e=r[t].slice(0,50),a=d3.min(e,function(t){return t["Local Trend"]}),n=d3.max(e,function(t){return t["Local Trend"]});o=Math.max(o,Math.max(Math.abs(a),Math.abs(n)))}),$("#trends-time").attr("min",c[0]).attr("max",c[c.length-1]).on("input change",function(){s.year=$(this).val(),s.yearLabel=s.year==d?"2020":s.year,a(s)}),s={bubbleByYear:r,years:c,year:c[0],yearLabel:c[0],absMaxX:.5,absMaxY:o},this.bubbleObj=s,this.count&&(i=i.slice(0,this.count)),this.data=i}},{key:"draw",value:function(){var t=!0,e=this.element,a=this.data,n=this.bubbleObj,i=this.callback;e.selectAll("*").remove(),e.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","trends-table-search").on("keyup",function(){var t=this.value.trim().toLowerCase(),e=0;l.each(function(a){var n=d3.select(this),i=-1!=a.Industry.toLowerCase().indexOf(t);n.style("background",e%2?"#fff":"#eee").style("display",i?"table-row":"none"),i&&e++})});var r=e.append("table"),s=d3.keys(a[0]).filter(function(t){return"bubbleByYear"!==t}),o=r.append("thead").append("tr").selectAll("th").data(s).enter().append("th").text(function(t){return t}).on("click",function(e,a){o.attr("class","header"),t?(0===a?(l.sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0})})):(l.sort(function(t,a){return+t[e].replace(/[^-.0-9]+/g,"")-+a[e].replace(/[^-.0-9]+/g,"")}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return+(t[e]+"").replace(/[^-.0-9]+/g,"")-+(a[e]+"").replace(/[^-.0-9]+/g,"")})})),t=!1,this.className="aes"):(0===a?(l.sort(function(t,a){return a[e]<t[e]?-1:a[e]>t[e]?1:0}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return a[e]<t[e]?-1:a[e]>t[e]?1:0})})):(l.sort(function(t,a){return+a[e].replace(/[^-.0-9]+/g,"")-+t[e].replace(/[^-.0-9]+/g,"")}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,a){return+(a[e]+"").replace(/[^-.0-9]+/g,"")-+(t[e]+"").replace(/[^-.0-9]+/g,"")})})),t=!0,this.className="des"),r.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"});var s=0;n.years.map(function(t){var e=n.bubbleByYear[t].slice(0,50),a=d3.min(e,function(t){return t["Local Trend"]}),i=d3.max(e,function(t){return t["Local Trend"]});s=Math.max(s,Math.max(Math.abs(a),Math.abs(i)))}),n.absMaxX=.5,n.absMaxY=s,i(n)}),l=r.append("tbody").selectAll("tr").data(a).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});l.selectAll("td").data(function(t){return s.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}}]),t}();