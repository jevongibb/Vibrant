"use strict";var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,a,n){return a&&t(e.prototype,a),n&&t(e,n),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e,a){a.vibrant||(a.vibrant={}),a.loadActivity=function(a){!function(a,n){var o="Austin";function s(a){t.queue(2).defer(t.csv,"./data/"+a+"_Master_Traded.csv").await(function(a,n){if(a)throw a;(function(a){var n=e("#activity-bubble-wrapper").width()||960,i=e("#activity-bubble-wrapper").height()||550,o=12,s=[];a.map(function(t){s.push({text:t.Label,size:+t[2015],group:t.Group})});var l=[];s.forEach(function(t){l.contains(t.group)||l.push(t.group)});for(var c=s.length,d=l.length,u=new Array(d),h=[],p=0;p<c;p++)h.push(f(s,p));function f(t,e){var a=l.indexOf(t[e].group),r=Math.sqrt((a+1)/d*-Math.log(Math.random()))*o,s={cluster:a,index:e,radius:.002*t[e].size,text:t[e].text,x:200*Math.cos(a/d*2*Math.PI)+n/2+Math.random(),y:200*Math.sin(a/d*2*Math.PI)+i/2+Math.random()};return(!u[a]||r>u[a].radius)&&(u[a]=s),s}new r({element:t.select("#activity-bubble-wrapper").node(),data:{nodes:h,links:[]}})})(n),function(e){var a=[];e.map(function(t){t["Relative Size (RS)"]=(+t["Relative Size (RS)"]).toFixed(2),t.Employees=i(t.Employees),a.push({NAICS:t.naics,Description:t.Label,Employees:i(+t[2015]),"Relative Size":(+t.RS_2015).toFixed(2),"% Total":(100*+t.Pct_Total).toFixed(2)+"%"})}),a.sort(function(t,e){return+e.Employees.replace(/[^0-9]+/g,"")-+t.Employees.replace(/[^0-9]+/g,"")});var n=!0,r=t.select("#activity-table-wrapper");r.selectAll("*").remove(),r.append("div").append("input").attr("placeholder","Search by Description...").attr("type","text").attr("id","activity-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),a=0;c.each(function(n){var i=t.select(this),r=-1!=n.Description.toLowerCase().indexOf(e);i.style("background",a%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&a++})});var o=r.append("table"),s=t.keys(a[0]),l=o.append("thead").append("tr").selectAll("th").data(s).enter().append("th").text(function(t){return t}).on("click",function(t,e){l.attr("class","header"),n?(1===e?c.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):c.sort(function(e,a){return+e[t].replace(/[^0-9]+/g,"")-+a[t].replace(/[^0-9]+/g,"")}),n=!1,this.className="aes"):(1===e?c.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):c.sort(function(e,a){return+a[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),n=!0,this.className="des"),o.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),c=o.append("tbody").selectAll("tr").data(a).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});c.selectAll("td").data(function(t){return s.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(n)})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){o=e(this).data("value"),e(".dropdown-value").text(o),e(".dropdown-hidden").toggleClass("visibility-visible"),s(o)}),function(){var e=t.select("#activity-bubble-legend div");e.selectAll("*").remove();var a=e.append("div").attr("class","activity-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,n){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){a.text(t.tooltip),a.style("visibility","visible")}).on("mousemove",function(){a.style("top",24*n+5+"px").style("right","40px")}).on("mouseout",function(){return a.style("visibility","hidden")})})}(),s(o),e.isFunction(n)&&n()}(0,a)};var n=t.format(",");function i(t){return n(+t||0)||0}Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1};var r=function(){function e(a){_classCallCheck(this,e),this.data=a.data,this.element=a.element,this.color=t.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]),this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400,this.margin={top:0,right:10,bottom:0,left:0},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=t.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var a=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=e.append("div").attr("class","item activity-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(e){var a=this,n=this.tooltip,i=t.forceSimulation().force("link",t.forceLink().id(function(t){return t.index})).force("collide",t.forceCollide(function(t){return t.radius+1}).iterations(12)).force("charge",t.forceManyBody().strength(-1)).force("center",t.forceCenter(this.width/2,this.height/2)).force("y",t.forceY(0)).force("x",t.forceX(0)),r=this.container.append("g").attr("class","links").selectAll("line").data(e.links).enter().append("line").attr("stroke","transparent"),o=this.container.append("g").attr("class","nodes").selectAll(".node").data(e.nodes).enter().append("g").attr("class","node"),s=this.padding;o.append("circle").attr("r",function(t){return t.radius||0}).style("fill",function(t){return a.color(t.cluster)}).style("cursor","pointer").on("mouseover",function(t){n.text(t.text),n.style("visibility","visible")}).on("mousemove",function(e){s.top<=0?n.style("top",e.y+"px").style("left",t.event.pageX-s.left+10+"px"):n.style("top",t.event.pageY-s.top-10+"px").style("left",t.event.pageX-s.left+10+"px")}).on("mouseout",function(){return n.style("visibility","hidden")}).call(t.drag().on("start",function(e){t.event.active||i.alphaTarget(.3).restart(),n.style("visibility","hidden"),e.fx=e.x,e.fy=e.y}).on("drag",function(e){e.fx=t.event.x,e.fy=t.event.y}).on("end",function(e){t.event.active||i.alphaTarget(0),n.style("visibility","visible"),e.fx=null,e.fy=null})),o.append("text").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){return t.text.split(" ")[0].length>t.radius/3?"":t.text.substring(0,t.radius/3)});i.nodes(e.nodes).on("tick",function(){r.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),o.select("circle").attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),o.select("text").attr("x",function(t){return t.x}).attr("y",function(t){return t.y})}),i.force("link").links(e.links)}}]),e}()}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadLocal=function(r){!function(r,o){var s="Austin";function l(r){t.queue(2).defer(t.csv,"./data/"+r+"_Master_Local.csv").await(function(r,o){if(r)throw r;var s=[],l=(o.reduce(function(t,e,a){return t[e.naics]=e,t},{}),t.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]));o.sort(function(t,e){return+e[2015]-+t[2015]}),o.map(function(t,e){var a;s.push({Color:l([+t.Group])||"gray",Industry:t.Label,Employees:(a=t[2015],n(+a||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),function(e){var a=!0,n=t.select("#local-table-wrapper");n.selectAll("*").remove(),n.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","local-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),a=0;s.each(function(n){var i=t.select(this),r=-1!=n.Industry.toLowerCase().indexOf(e);i.style("background",a%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&a++})});var i=n.append("table"),r=t.keys(e[0]).filter(function(t){return"Color"!==t}),o=i.append("thead").append("tr").selectAll("th").data(r).enter().append("th").text(function(t){return t}).on("click",function(t,e){o.attr("class","header"),a?(0===e?s.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):s.sort(function(e,a){return+(e[t]+"").replace(/[^0-9]+/g,"")-+(a[t]+"").replace(/[^0-9]+/g,"")}),a=!1,this.className="aes"):(0===e?s.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):s.sort(function(e,a){return+(a[t]+"").replace(/[^0-9]+/g,"")-+(e[t]+"").replace(/[^0-9]+/g,"")}),a=!0,this.className="des"),i.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=i.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return r.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(s),s.sort(function(t,e){return+e["Relative Size"]-+t["Relative Size"]}),c=s.splice(0,10).concat(s.splice(s.length-10,s.length)),d=new i({element:document.querySelector("#local-bubble-wrapper"),data:c}),e(a).on("resize",function(){return d.draw()});var c,d})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){s=e(this).data("value"),e(".dropdown-value").text(s),e(".dropdown-hidden").toggleClass("visibility-visible"),l(s)}),l(s),e.isFunction(o)&&o()}(0,r)};var n=t.format(",");var i=function(){function e(a){_classCallCheck(this,e),this.data=a.data,this.element=a.element,this.color=t.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]),this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400,this.margin={top:30,right:50,bottom:70,left:50},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=t.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var a=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=e.append("div").attr("class","item local-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(e){var a=this,n=this.tooltip,i=t.scaleBand().range([0,this.width]).padding(.1),r=t.scaleLinear().range([0,this.height]),o=t.scaleLinear().range([5,25]).domain(t.extent(e,function(t){return+t["Relative Size"]}));i.domain(e.map(function(t){return t.Industry})),r.domain([t.min(e,function(t){return-t["Relative Size"]}),t.max(e,function(t){return-t["Relative Size"]})]),this.container.append("line").style("stroke","#000").style("stroke-width","2px").attr("x1",0).attr("x2",this.width).attr("y1",r(-1)).attr("y2",r(-1)),this.container.append("text").attr("x",this.width+5).attr("y",r(-1)+4).text("RS = 1");var s=this.padding;this.container.selectAll(".bubble").data(e).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return t.Color||a.color(e)}).attr("cy",function(t){return t["Relative Size"]>0?r(Math.min(0,-t["Relative Size"])):r(Math.min(0,-t["Relative Size"]))+Math.abs(r(t["Relative Size"])-r(0))}).attr("cx",function(t){return i(t.Industry)+i.bandwidth()/2}).attr("r",function(t,e){return o(t["Relative Size"])}).style("cursor","pointer").on("mouseover",function(t){n.html("<p>"+t.Industry+"</p><p>Relative Size: "+t["Relative Size"]+"</p><p>Employees: "+t.Employees+"</p>"),n.style("visibility","visible")}).on("mousemove",function(e){var a=e["Relative Size"]>0?r(Math.min(0,-e["Relative Size"])):r(Math.min(0,-e["Relative Size"]))+Math.abs(r(e["Relative Size"])-r(0));n.style("top",a+"px").style("left",t.event.pageX-s.left+10+"px")}).on("mouseout",function(){return n.style("visibility","hidden")})}}]),e}()}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadSwot=function(a){!function(a,n){var i="Austin",r={strengths:{caption:"#4472c4",thead:"#8ea9db",tbody:"#d9e1f2"},weaknesses:{caption:"#ffc000",thead:"#ffd966",tbody:"#fff2cc"},opportunities:{caption:"#70ad47",thead:"#a9d08e",tbody:"#e2efda"},threats:{caption:"#ff0000",thead:"#ff7c80",tbody:"#ffcccc"}};function o(e,a){t.csv("./data/"+e+"_SWOT_"+a+".csv",function(e,n){if(e)throw e;var i=!0,o=t.select("#swot-"+a+"-wrapper");o.selectAll("table").remove();var s=o.append("table"),l=t.keys(n[0]);s.append("caption").text(a.toUpperCase()).style("background",r[a].caption);var c=s.append("thead").append("tr").selectAll("th").data(l).enter().append("th").style("background",r[a].thead).text(function(t){return t}).on("click",function(t,e){c.attr("class","header"),i?(1===e?d.sort(function(e,a){return e[t]<a[t]?-1:e[t]>a[t]?1:0}):d.sort(function(e,a){return+e[t].replace(/[^0-9]+/g,"")-+a[t].replace(/[^0-9]+/g,"")}),i=!1,this.className="aes"):(1===e?d.sort(function(e,a){return a[t]<e[t]?-1:a[t]>e[t]?1:0}):d.sort(function(e,a){return+a[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),i=!0,this.className="des")}),d=s.append("tbody").selectAll("tr").data(n).enter().append("tr").style("background",r[a].tbody);d.selectAll("td").data(function(t){return l.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){i=e(this).data("value"),e(".dropdown-value").text(i),e(".dropdown-hidden").toggleClass("visibility-visible"),o(i,"strengths"),o(i,"weaknesses"),o(i,"opportunities"),o(i,"threats")}),o(i,"strengths"),o(i,"weaknesses"),o(i,"opportunities"),o(i,"threats"),e.isFunction(n)&&n()}(0,a)}}(d3,$,window),function(t,e,a){a.vibrant||(a.vibrant={}),a.loadTrends=function(i){!function(i,o){var s="Austin";function l(n){var i=n.bubbleByYear[n.year].slice(0,50),o=new r({element:t.select("#trends-bubble-wrapper").node(),data:i,year:n.yearLabel,datas:n.bubbleByYear,years:n.years,absMaxX:n.absMaxX,absMaxY:n.absMaxY});e(a).on("resize",function(){return o.draw()})}function c(a){t.queue(2).defer(t.csv,"./data/"+a+"_Master_Traded.csv").await(function(a,i){if(a)throw a;var r=[],o={},s={},c=0,d=(i.reduce(function(t,e,a){return t[e.naics]=e,t},{}),t.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"])),u=t.keys(i[0]).filter(function(t){return-1!==t.indexOf("L_T_")}).map(function(t){return t=+t.replace(/[^0-9]+/g,""),o[t]=[],t}),h=u[u.length-1]+1;u.push(h),o[h]=[],u.sort(function(t,e){return t-e}),i.sort(function(t,e){return+e[2015]-+t[2015]}),i.map(function(t,e){var a;r.push({Industry:t.Label,Employees:(a=t[2015],n(+a||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"}),u.map(function(e){e!==h?o[e].push({Color:d([+t.Group])||"gray",Industry:t.Label,"Local Trend":+t["L_T_"+e]||0,"National Trend":+t["N_T_"+e]||0,"Relative Size":+t.RS_2015,Employees:+t[2015],"Nat’l Trend":+t.Natl_Trend||0}):o[e].push({Color:d([+t.Group])||"gray",Industry:t.Label,"Local Trend":+t.Local_Trend||0,"National Trend":+t.Natl_Trend||0,"Relative Size":+t.RS_2015,Employees:+t[2015],"Nat’l Trend":+t.Natl_Trend||0})})}),u.map(function(e){var a=o[e].slice(0,50),n=t.min(a,function(t){return t["Local Trend"]}),i=t.max(a,function(t){return t["Local Trend"]});c=Math.max(c,Math.max(Math.abs(n),Math.abs(i)))}),.5,e("#trends-time").attr("min",u[0]).attr("max",u[u.length-1]).on("input change",function(){s.year=e(this).val(),s.yearLabel=s.year==h?"2020":s.year,l(s)}),s={bubbleByYear:o,years:u,year:u[0],yearLabel:u[0],absMaxX:.5,absMaxY:c},function(e,a){var n=!0,i=t.select("#trends-table-wrapper");i.selectAll("*").remove(),i.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","trends-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),a=0;c.each(function(n){var i=t.select(this),r=-1!=n.Industry.toLowerCase().indexOf(e);i.style("background",a%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&a++})});var r=i.append("table"),o=t.keys(e[0]),s=r.append("thead").append("tr").selectAll("th").data(o).enter().append("th").text(function(t){return t}).on("click",function(e,i){s.attr("class","header"),n?(0===i?(c.sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0}),a.years.map(function(t){a.bubbleByYear[t].sort(function(t,a){return t[e]<a[e]?-1:t[e]>a[e]?1:0})})):(c.sort(function(t,a){return+t[e].replace(/[^0-9]+/g,"")-+a[e].replace(/[^0-9]+/g,"")}),a.years.map(function(t){a.bubbleByYear[t].sort(function(t,a){return+(t[e]+"").replace(/[^0-9]+/g,"")-+(a[e]+"").replace(/[^0-9]+/g,"")})})),n=!1,this.className="aes"):(0===i?(c.sort(function(t,a){return a[e]<t[e]?-1:a[e]>t[e]?1:0}),a.years.map(function(t){a.bubbleByYear[t].sort(function(t,a){return a[e]<t[e]?-1:a[e]>t[e]?1:0})})):(c.sort(function(t,a){return+a[e].replace(/[^0-9]+/g,"")-+t[e].replace(/[^0-9]+/g,"")}),a.years.map(function(t){a.bubbleByYear[t].sort(function(t,a){return+(a[e]+"").replace(/[^0-9]+/g,"")-+(t[e]+"").replace(/[^0-9]+/g,"")})})),n=!0,this.className="des"),r.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"});var o=0;a.years.map(function(e){var n=a.bubbleByYear[e].slice(0,50),i=t.min(n,function(t){return t["Local Trend"]}),r=t.max(n,function(t){return t["Local Trend"]});o=Math.max(o,Math.max(Math.abs(i),Math.abs(r)))}),a.absMaxX=.5,a.absMaxY=o,l(a)}),c=r.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});c.selectAll("td").data(function(t){return o.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(r,s),l(s)})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){s=e(this).data("value"),e(".dropdown-value").text(s),e(".dropdown-hidden").toggleClass("visibility-visible"),c(s)}),function(){var e=t.select("#trends-bubble-legend div");e.selectAll("*").remove();var a=e.append("div").attr("class","trends-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,n){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){a.text(t.tooltip),a.style("visibility","visible")}).on("mousemove",function(){a.style("top",24*n+5+"px").style("right","40px")}).on("mouseout",function(){return a.style("visibility","hidden")})})}(),c(s),e.isFunction(o)&&o()}(0,i)};var n=t.format(",");function i(t,e){var a=(i.canvas||(i.canvas=document.createElement("canvas"))).getContext("2d");return a.font=e||'24px "Helvetica Neue"',a.measureText(t).width}var r=function(){function e(a){_classCallCheck(this,e),this.data=a.data,this.year=a.year||"",this.datas=a.datas,this.years=a.years||"",this.absMaxX=a.absMaxX||0,this.absMaxY=a.absMaxY||0,this.element=a.element,this.color=t.scaleOrdinal().range(["#a6761d","#666666","#377eb8","#984ea3","#73c000","#ff7f00","#e31a1c","#e6ab02"]),this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400;var e=Math.min(this.width,this.height);this.width=e,this.height=e,this.margin={top:40,right:40,bottom:40,left:40},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var a=t.select(this.element);a.selectAll(".item").remove(),this.padding=a.node().getBoundingClientRect();var n=a.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=n.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.createBubbles()}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(){var e=this,a=1.6,n=this,r=t.scaleLinear().range([0,this.width]),o=t.scaleLinear().range([this.height,0]),s=t.line().x(function(t){return r(t.x)}).y(function(t){return t.y>a?o(a):t.y<-a?o(-a):o(t.y)}),l=t.scaleLinear().range([2,18]).domain(t.extent(n.data,function(t){return+t.Employees}));r.domain([-this.absMaxX,+this.absMaxX]),this.absMaxY>1.5?o.domain([-1.6,1.6]):o.domain([-this.absMaxY,this.absMaxY]);var c=Math.min(this.absMaxY,this.absMaxX);this.container.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+this.height+")").call(t.axisBottom(r).tickSize(-this.height)),this.container.append("g").attr("class","y-axis axis").call(t.axisLeft(o).tickSize(-this.width)),this.container.append("rect").attr("class","around").attr("x",0).attr("y",0).attr("height",this.height).attr("width",this.width),this.container.append("line").attr("class","like-axis").attr("x1",0).attr("x2",this.width).attr("y1",o(0)).attr("y2",o(0)),this.container.append("line").attr("class","like-axis").attr("x1",r(0)).attr("x2",r(0)).attr("y1",0).attr("y2",this.height),this.container.append("text").attr("class","label-axis label-y-axis").attr("text-anchor","middle").attr("transform","translate("+(15-this.margin.left)+","+this.height/2+")rotate(-90)").text("Local Trend (% Change in # Employees)"),this.container.append("text").attr("class","label-axis label-x-axis").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-(15-this.margin.bottom))+")").text("National Trend (% Change in # Employees)"),this.absMaxY>1.5&&(this.container.append("text").attr("class","more-than-y-max").attr("y",5).attr("x",-22.5).text(">1.5"),this.container.append("circle").attr("class","more-than-y-max").style("fill","#fff").style("stroke-width","0").attr("cx",r(0)).attr("cy",o(1.52)).attr("r",2),this.container.append("line").attr("class","more-than-y-max").attr("x1",r(-.02)).attr("x2",r(.02)).attr("y1",o(1.47)).attr("y2",o(1.53)),this.container.append("line").attr("class","more-than-y-max").attr("x1",r(-.02)).attr("x2",r(.02)).attr("y1",o(1.51)).attr("y2",o(1.57)));this.container.append("text").attr("class","year label").attr("y",this.height-5).attr("x",this.width-5).text(this.year);var d=this.container.append("text").attr("class","description label").attr("y",-10).attr("x",0).text(""),u=(this.padding,this.container.selectAll(".bubble").data(n.data).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,a){return t.Color||e.color(a)}).attr("cy",function(t){return t["Local Trend"]>a?o(a):t["Local Trend"]<-a?o(-a):o(t["Local Trend"])}).attr("cx",function(t){return r(t["National Trend"])}).attr("r",function(t){return l(t.Employees)}).style("cursor","pointer").on("mouseover",function(e){u.style("opacity",1),t.select(this).style("opacity",1);var a=i(e.Industry)||n.width+1;d.text(a<n.width?e.Industry:e.Industry.substring(0,38)+"..."),n.container.selectAll(".history").remove();var r=[];n.years.map(function(t){n.datas[t].map(function(t){e.Industry===t.Industry&&r.push({x:t["National Trend"],y:t["Local Trend"]})})}),n.container.append("path").data([r]).classed("history background-history",!0).attr("d",s);var o=t.transition().duration(1e3).ease(t.easeLinear),l=n.container.selectAll(".animated-history").data([r]);l.enter().append("path").classed("history animated-history",!0).merge(l).attr("d",s).attr("stroke-dasharray",function(t){return this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}),n.container.selectAll(".animated-history").transition(o).attr("stroke-dashoffset",0)}).on("mouseout",function(){d.text(""),e.container.selectAll(".history").remove(),u.style("opacity",1)}));this.container.append("line").attr("class","like-diagonal").attr("x1",r(-c)).attr("x2",r(+c)).attr("y1",o(-c)).attr("y2",o(+c))}}]),e}()}(d3,$,window),$(function(){window.vibrant||(window.vibrant={});var t,e=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(t){8==t.which&&(!e.test(t.target.tagName)||t.target.disabled||t.target.readOnly)&&t.preventDefault()}),window.onpopstate=function(t){$(document).ready(function(){n(!0),loadPage({},!0)})},$(document).ready(function(){t=$("#loading-wrapper"),n(!0),$("#navigation .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");loadPage({page:e})}),loadPage({},!0)});var a={activity:{page:"activity",nav:"graphs",event:window.loadActivity,nextAjax:function(){t.addClass("hidden")}},trends:{page:"trends",nav:"graphs",event:window.loadTrends,nextAjax:function(){t.addClass("hidden")}},local:{page:"local",nav:"graphs",event:window.loadLocal,nextAjax:function(){t.addClass("hidden")}},swot:{page:"swot",nav:"graphs",event:window.loadSwot,nextAjax:function(){t.addClass("hidden")}}};function n(t){var e=$("#header").height();$("#container").css("margin-top",e),$("#page-wrapper").css("min-height",$(window).height()-e)}window.loadPage=function e(i,r){var o=i.page||function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var a=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return a?a[2]?decodeURIComponent(a[2].replace(/\+/g," ")):"":null}("page",window.location.search)||"activity";"nolink"!==o&&(t.removeClass("hidden"),o=o.replace("#","").replace(/[^a-zA-Z]+/g,""),a[o]?o&&(window.history.pushState({page:o},o,"?page="+o),"graphs"===a[o].nav&&r&&($("#navigation .link-to").removeClass("link-to-active"),$("#navigation .link-to-"+a[o].nav).addClass("link-to-active"),$("#sub-navigation-wrapper").empty().load("graphs_nav.html",function(t){$("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+o).addClass("link-to-active"),$("#sub-navigation-wrapper .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var a=$(this).data("link-to");"nolink"!==a&&($("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+a).addClass("link-to-active"),e({page:a}))}),n(!1)})),$("#page-wrapper").empty().load(a[o].page+".html",function(t){$.isFunction(a[o].callback)&&a[o].callback(),$.isFunction(a[o].prevAjax)&&a[o].prevAjax(),$.isFunction(a[o].event)&&a[o].event(a[o].nextAjax)})):window.open(window.location.origin+"?page=activity","_self"))},$(window).on("resize",n)});