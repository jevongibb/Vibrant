"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,n,a){return n&&t(e.prototype,n),a&&t(e,a),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}!function(t,e,n){n.vibrant||(n.vibrant={}),n.loadActivity=function(n){!function(n,a){var o="Austin";function s(n){t.queue(2).defer(t.csv,"./data/"+n+"_Master_Traded.csv").defer(t.csv,"./data/color_legend.csv").await(function(n,a,o){if(n)throw n;(function(n,a){var i=a.reduce(function(t,e,n){return t[e.Group]=e,t},{}),o=e("#activity-bubble-wrapper").width()||960,s=e("#activity-bubble-wrapper").height()||550,l=12,c=[];n.map(function(t){c.push({text:t.Label,size:+t[2015],group:t.Group})});var d=[];c.forEach(function(t){d.contains(t.group)||d.push(t.group)});for(var u=c.length,p=d.length,h=new Array(p),f=[],g=0;g<u;g++)f.push(v(c,g));function v(t,e){var n=d.indexOf(t[e].group),a=Math.sqrt((n+1)/p*-Math.log(Math.random()))*l,r={color:i[n].Hex,cluster:n,index:e,radius:.002*t[e].size,text:t[e].text,x:200*Math.cos(n/p*2*Math.PI)+o/2+Math.random(),y:200*Math.sin(n/p*2*Math.PI)+s/2+Math.random()};return(!h[n]||a>h[n].radius)&&(h[n]=r),r}new r({element:t.select("#activity-bubble-wrapper").node(),data:{nodes:f,links:[]}})})(a,o),function(e){var n=[];e.map(function(t){t["Relative Size (RS)"]=(+t["Relative Size (RS)"]).toFixed(2),t.Employees=i(t.Employees),n.push({NAICS:t.naics,Description:t.Label,Employees:i(+t[2015]),"Relative Size":(+t.RS_2015).toFixed(2),"% Total":(100*+t.Pct_Total).toFixed(2)+"%"})}),n.sort(function(t,e){return+e.Employees.replace(/[^0-9]+/g,"")-+t.Employees.replace(/[^0-9]+/g,"")});var a=!0,r=t.select("#activity-table-wrapper");r.selectAll("*").remove(),r.append("div").append("input").attr("placeholder","Search by Description...").attr("type","text").attr("id","activity-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),n=0;c.each(function(a){var i=t.select(this),r=-1!=a.Description.toLowerCase().indexOf(e);i.style("background",n%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&n++})});var o=r.append("table"),s=t.keys(n[0]),l=o.append("thead").append("tr").selectAll("th").data(s).enter().append("th").text(function(t){return t}).on("click",function(t,e){l.attr("class","header"),a?(1===e?c.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):c.sort(function(e,n){return+e[t].replace(/[^0-9]+/g,"")-+n[t].replace(/[^0-9]+/g,"")}),a=!1,this.className="aes"):(1===e?c.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):c.sort(function(e,n){return+n[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),a=!0,this.className="des"),o.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),c=o.append("tbody").selectAll("tr").data(n).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});c.selectAll("td").data(function(t){return s.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(a)})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){o=e(this).data("value"),e(".dropdown-value").text(o),e(".dropdown-hidden").toggleClass("visibility-visible"),s(o)}),function(){var e=t.select("#activity-bubble-legend div");e.selectAll("*").remove();var n=e.append("div").attr("class","activity-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,a){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){n.text(t.tooltip),n.style("visibility","visible")}).on("mousemove",function(){n.style("top",24*a+5+"px").style("right","40px")}).on("mouseout",function(){return n.style("visibility","hidden")})})}(),s(o),e.isFunction(a)&&a()}(0,n)};var a=t.format(",");function i(t){return a(+t||0)||0}Array.prototype.contains=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return!0;return!1};var r=function(){function e(t){_classCallCheck(this,e),this.data=t.data,this.element=t.element,this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400,this.margin={top:0,right:10,bottom:0,left:0},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=t.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var n=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=n.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=e.append("div").attr("class","item activity-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(e){var n=this,a=t.forceSimulation().force("link",t.forceLink().id(function(t){return t.index})).force("collide",t.forceCollide(function(t){return t.radius+1}).iterations(12)).force("charge",t.forceManyBody().strength(-1)).force("center",t.forceCenter(this.width/2,this.height/2)).force("y",t.forceY(0)).force("x",t.forceX(0)),i=this.container.append("g").attr("class","links").selectAll("line").data(e.links).enter().append("line").attr("stroke","transparent"),r=this.container.append("g").attr("class","nodes").selectAll(".node").data(e.nodes).enter().append("g").attr("class","node"),o=this.padding;r.append("circle").attr("r",function(t){return t.radius||0}).style("fill",function(t){return t.color}).style("cursor","pointer").on("mouseover",function(t){n.tooltip.text(t.text),n.tooltip.style("visibility","visible")}).on("mousemove",function(e){o.top<=0?n.tooltip.style("top",e.y+"px").style("left",t.event.pageX-o.left+10+"px"):n.tooltip.style("top",t.event.pageY-o.top-10+"px").style("left",t.event.pageX-o.left+10+"px")}).on("mouseout",function(){return n.tooltip.style("visibility","hidden")}).call(t.drag().on("start",function(e){t.event.active||a.alphaTarget(.3).restart(),n.tooltip.style("visibility","hidden"),e.fx=e.x,e.fy=e.y}).on("drag",function(e){e.fx=t.event.x,e.fy=t.event.y}).on("end",function(e){t.event.active||a.alphaTarget(0),n.tooltip.style("visibility","visible"),e.fx=null,e.fy=null})),r.append("text").attr("class","first-row").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){return t.text.split(" ")[0].length>t.radius/3?(t.isFirstRow=!1,""):(t.isFirstRow=!0,t.text.substring(0,t.radius/3))}),r.append("text").attr("class","second-row").attr("dy",".3em").style("fill","white").style("text-anchor","middle").style("cursor","default").style("pointer-events","none").text(function(t){return t.text.split(" ")[0].length>t.radius/3?(t.isSecondRow=!1,""):(t.isSecondRow=!0,t.text.substring(t.radius/3,2*t.radius/3))});a.nodes(e.nodes).on("tick",function(){r.each(function(e){var a=t.select(this);e.x=Math.max(e.radius,Math.min(n.width-e.radius,e.x)),e.y=Math.max(e.radius,Math.min(n.height-e.radius,e.y)),a.select("circle").attr("cx",e.x).attr("cy",e.y),a.select(".first-row").attr("x",e.x).attr("y",e.isSecondRow?e.y-6:e.y),a.select(".second-row").attr("x",e.x).attr("y",e.isSecondRow?e.y+6:e.y)}),i.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y})}),a.force("link").links(e.links)}}]),e}()}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadLocal=function(r){!function(r,o){var s="Austin";function l(r){t.queue(2).defer(t.csv,"./data/"+r+"_Master_Local.csv").defer(t.csv,"./data/color_legend.csv").await(function(r,o,s){if(r)throw r;var l=[],c=(o.reduce(function(t,e,n){return t[e.naics]=e,t},{}),s.reduce(function(t,e,n){return t[e.Group]=e,t},{}));o.sort(function(t,e){return+e[2015]-+t[2015]}),o.map(function(t,e){var n;l.push({color:c[t.naics[0]].Hex||"gray",Industry:t.Label,Employees:(n=t[2015],a(+n||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),function(e){var n=!0,a=t.select("#local-table-wrapper");a.selectAll("*").remove(),a.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","local-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),n=0;s.each(function(a){var i=t.select(this),r=-1!=a.Industry.toLowerCase().indexOf(e);i.style("background",n%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&n++})});var i=a.append("table"),r=t.keys(e[0]).filter(function(t){return"color"!==t}),o=i.append("thead").append("tr").selectAll("th").data(r).enter().append("th").text(function(t){return t}).on("click",function(t,e){o.attr("class","header"),n?(0===e?s.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):s.sort(function(e,n){return+(e[t]+"").replace(/[^0-9]+/g,"")-+(n[t]+"").replace(/[^0-9]+/g,"")}),n=!1,this.className="aes"):(0===e?s.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):s.sort(function(e,n){return+(n[t]+"").replace(/[^0-9]+/g,"")-+(e[t]+"").replace(/[^0-9]+/g,"")}),n=!0,this.className="des"),i.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"})}),s=i.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});s.selectAll("td").data(function(t){return r.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(l),l.sort(function(t,e){return+e["Relative Size"]-+t["Relative Size"]}),d=l.splice(0,10).concat(l.splice(l.length-10,l.length)),u=new i({element:document.querySelector("#local-bubble-wrapper"),data:d}),e(n).on("resize",function(){return u.draw()});var d,u})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){s=e(this).data("value"),e(".dropdown-value").text(s),e(".dropdown-hidden").toggleClass("visibility-visible"),l(s)}),function(){var e=t.select("#local-bubble-legend div");e.selectAll("*").remove();var n=e.append("div").attr("class","local-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,a){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){n.text(t.tooltip),n.style("visibility","visible")}).on("mousemove",function(){n.style("top",24*a+5+"px").style("right","40px")}).on("mouseout",function(){return n.style("visibility","hidden")})})}(),l(s),e.isFunction(o)&&o()}(0,r)};var a=t.format(",");var i=function(){function e(t){_classCallCheck(this,e),this.data=t.data,this.element=t.element,this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400,this.margin={top:30,right:100,bottom:70,left:100},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var e=t.select(this.element);e.selectAll(".item").remove(),this.padding=e.node().getBoundingClientRect();var n=e.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=n.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.tooltip=e.append("div").attr("class","item local-bubble-tooltip").style("visibility","hidden"),this.createBubbles(this.data)}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(e){var n=this.tooltip,a=t.scaleBand().range([0,this.width]).padding(.1),i=t.scaleLinear().range([0,this.height]),r=t.scaleLinear().range([5,25]).domain(t.extent(e,function(t){return+t.Employees.replace(/[^0-9]+/g,"")}));a.domain(e.map(function(t){return t.Industry})),i.domain([t.min(e,function(t){return-t["Relative Size"]}),t.max(e,function(t){return-t["Relative Size"]})]),this.container.append("line").style("stroke","#000").style("stroke-width","2px").attr("x1",0).attr("x2",this.width).attr("y1",i(-1)).attr("y2",i(-1)),this.container.append("text").attr("x",this.width+5).attr("y",i(-1)+4).text("RS = 1");var o=this.padding;this.container.selectAll(".bubble").data(e).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return t.color}).attr("cy",function(t){return t["Relative Size"]>0?i(Math.min(0,-t["Relative Size"])):i(Math.min(0,-t["Relative Size"]))+Math.abs(i(t["Relative Size"])-i(0))}).attr("cx",function(t){return a(t.Industry)+a.bandwidth()/2}).attr("r",function(t,e){return r(t.Employees.replace(/[^0-9#]+/g,""))}).style("cursor","pointer").on("mouseover",function(t){n.html("<p>"+t.Industry+"</p><p>Relative Size: "+t["Relative Size"]+"</p><p>Employees: "+t.Employees+"</p>"),n.style("visibility","visible")}).on("mousemove",function(e){var a=e["Relative Size"]>0?i(Math.min(0,-e["Relative Size"])):i(Math.min(0,-e["Relative Size"]))+Math.abs(i(e["Relative Size"])-i(0));n.style("top",a+"px").style("left",t.event.pageX-o.left+10+"px")}).on("mouseout",function(){return n.style("visibility","hidden")})}}]),e}()}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadNetwork=function(a){!function(a,i){var r="National";function o(a){var i=t.select("#network-wrapper");i.selectAll("*").remove();e(n);i.append("iframe").attr("width","100%").attr("height",e(n).height()+"px").attr("src",a.toLowerCase()+".html")}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){r=e(this).data("value"),e(".dropdown-value").text(r),e(".dropdown-hidden").toggleClass("visibility-visible"),o(r)}),o(r),e.isFunction(i)&&i()}(0,a)}}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadSwot=function(n){!function(n,a){var i="Austin",r={strengths:{caption:"#4472c4",thead:"#8ea9db",tbody:"#d9e1f2"},weaknesses:{caption:"#ffc000",thead:"#ffd966",tbody:"#fff2cc"},opportunities:{caption:"#70ad47",thead:"#a9d08e",tbody:"#e2efda"},threats:{caption:"#ff0000",thead:"#ff7c80",tbody:"#ffcccc"}};function o(e,n){t.csv("./data/"+e+"_SWOT_"+n+".csv",function(e,a){if(e)throw e;var i=!0,o=t.select("#swot-"+n+"-wrapper");o.selectAll("table").remove();var s=o.append("table"),l=t.keys(a[0]);s.append("caption").text(n.toUpperCase()).style("background",r[n].caption);var c=s.append("thead").append("tr").selectAll("th").data(l).enter().append("th").style("background",r[n].thead).text(function(t){return t}).on("click",function(t,e){c.attr("class","header"),i?(1===e?d.sort(function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:0}):d.sort(function(e,n){return+e[t].replace(/[^0-9]+/g,"")-+n[t].replace(/[^0-9]+/g,"")}),i=!1,this.className="aes"):(1===e?d.sort(function(e,n){return n[t]<e[t]?-1:n[t]>e[t]?1:0}):d.sort(function(e,n){return+n[t].replace(/[^0-9]+/g,"")-+e[t].replace(/[^0-9]+/g,"")}),i=!0,this.className="des")}),d=s.append("tbody").selectAll("tr").data(a).enter().append("tr").style("background",r[n].tbody);d.selectAll("td").data(function(t){return l.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){i=e(this).data("value"),e(".dropdown-value").text(i),e(".dropdown-hidden").toggleClass("visibility-visible"),o(i,"strengths"),o(i,"weaknesses"),o(i,"opportunities"),o(i,"threats")}),o(i,"strengths"),o(i,"weaknesses"),o(i,"opportunities"),o(i,"threats"),e.isFunction(a)&&a()}(0,n)}}(d3,$,window),function(t,e,n){n.vibrant||(n.vibrant={}),n.loadTrends=function(i){!function(i,o){var s="Austin";function l(a){var i=a.bubbleByYear[a.year].slice(0,50),o=new r({element:t.select("#trends-bubble-wrapper").node(),data:i,year:a.yearLabel,datas:a.bubbleByYear,years:a.years,absMaxX:a.absMaxX,absMaxY:a.absMaxY});e(n).on("resize",function(){return o.draw()})}function c(n){t.queue(2).defer(t.csv,"./data/"+n+"_Master_Traded.csv").defer(t.csv,"./data/color_legend.csv").await(function(n,i,r){if(n)throw n;var o=[],s={},c={},d=0,u=(i.reduce(function(t,e,n){return t[e.naics]=e,t},{}),r.reduce(function(t,e,n){return t[e.Group]=e,t},{})),p=t.keys(i[0]).filter(function(t){return-1!==t.indexOf("L_T_")}).map(function(t){return t=+t.replace(/[^0-9]+/g,""),s[t]=[],t}),h=p[p.length-1]+1;p.push(h),s[h]=[],p.sort(function(t,e){return t-e}),i.sort(function(t,e){return+e[2015]-+t[2015]}),i.map(function(t,e){var n,i={};p.map(function(e){i.year={},i.year=e==h?{color:u[t.naics[0]].Hex||"gray",Industry:t.Label,"Local Trend":+t.Local_Trend||0,"National Trend":+t.Natl_Trend||0,radius:+t[2020],Employees:+t[2015],"Relative Size":+t.RS_2015,"Nat’l Trend":+t.Natl_Trend||0}:{color:u[t.naics[0]].Hex||"gray",Industry:t.Label,"Local Trend":+t["L_T_"+e]||0,"National Trend":+t["N_T_"+e]||0,radius:+t[2020],Employees:+t[2015],"Relative Size":+t.RS_2015,"Nat’l Trend":+t.Natl_Trend||0},s[e].push(i.year)}),o.push({Industry:t.Label,Employees:(n=t[2015],a(+n||0)||0),"Relative Size":(+t.RS_2015).toFixed(2),"Local Trend":(100*+t.Local_Trend).toFixed(2)+"%","Nat’l Trend":(100*+t.Natl_Trend).toFixed(2)+"%"})}),p.map(function(e){var n=s[e].slice(0,50),a=t.min(n,function(t){return t["Local Trend"]}),i=t.max(n,function(t){return t["Local Trend"]});d=Math.max(d,Math.max(Math.abs(a),Math.abs(i)))}),.5,e("#trends-time").attr("min",p[0]).attr("max",p[p.length-1]).on("input change",function(){c.year=e(this).val(),c.yearLabel=c.year==h?"2020":c.year,l(c)}),c={bubbleByYear:s,years:p,year:p[0],yearLabel:p[0],absMaxX:.5,absMaxY:d},function(e,n){var a=!0,i=t.select("#trends-table-wrapper");i.selectAll("*").remove(),i.append("div").append("input").attr("placeholder","Search by Industry...").attr("type","text").attr("id","trends-table-search").on("keyup",function(){var e=this.value.trim().toLowerCase(),n=0;c.each(function(a){var i=t.select(this),r=-1!=a.Industry.toLowerCase().indexOf(e);i.style("background",n%2?"#fff":"#eee").style("display",r?"table-row":"none"),r&&n++})});var r=i.append("table"),o=t.keys(e[0]).filter(function(t){return"bubbleByYear"!==t}),s=r.append("thead").append("tr").selectAll("th").data(o).enter().append("th").text(function(t){return t}).on("click",function(e,i){s.attr("class","header"),a?(0===i?(c.sort(function(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,n){return t[e]<n[e]?-1:t[e]>n[e]?1:0})})):(c.sort(function(t,n){return+t[e].replace(/[^0-9]+/g,"")-+n[e].replace(/[^0-9]+/g,"")}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,n){return+(t[e]+"").replace(/[^0-9]+/g,"")-+(n[e]+"").replace(/[^0-9]+/g,"")})})),a=!1,this.className="aes"):(0===i?(c.sort(function(t,n){return n[e]<t[e]?-1:n[e]>t[e]?1:0}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,n){return n[e]<t[e]?-1:n[e]>t[e]?1:0})})):(c.sort(function(t,n){return+n[e].replace(/[^0-9]+/g,"")-+t[e].replace(/[^0-9]+/g,"")}),n.years.map(function(t){n.bubbleByYear[t].sort(function(t,n){return+(n[e]+"").replace(/[^0-9]+/g,"")-+(t[e]+"").replace(/[^0-9]+/g,"")})})),a=!0,this.className="des"),r.selectAll("tr").style("background",function(t,e){return e%2?"#eee":"#fff"});var o=0;n.years.map(function(e){var a=n.bubbleByYear[e].slice(0,50),i=t.min(a,function(t){return t["Local Trend"]}),r=t.max(a,function(t){return t["Local Trend"]});o=Math.max(o,Math.max(Math.abs(i),Math.abs(r)))}),n.absMaxX=.5,n.absMaxY=o,l(n)}),c=r.append("tbody").selectAll("tr").data(e).enter().append("tr").style("background",function(t,e){return e%2?"#fff":"#eee"});c.selectAll("td").data(function(t){return o.map(function(e){return{value:t[e],name:e}})}).enter().append("td").attr("data-th",function(t){return t.name}).text(function(t){return t.value})}(o,c),l(c)})}e(".dropdown-visible").off().on("click",function(){e(".dropdown-hidden").toggleClass("visibility-visible")}),e(".dropdown-item").off().on("click",function(){s=e(this).data("value"),e(".dropdown-value").text(s),e(".dropdown-hidden").toggleClass("visibility-visible"),c(s)}),function(){var e=t.select("#trends-bubble-legend div");e.selectAll("*").remove();var n=e.append("div").attr("class","trends-bubble-legend-tooltip").style("visibility","hidden");[{src:"group1.jpg",tooltip:"Ag, Fishing, Hunting, & Forestry"},{src:"group2.jpg",tooltip:"Mining, Utilities, & Construction"},{src:"group3.jpg",tooltip:"Manufacturing"},{src:"group4.jpg",tooltip:"Wholesale, Transport, & Warehousing"},{src:"group5.jpg",tooltip:"Services"},{src:"group6.jpg",tooltip:"Education & Healthcare"},{src:"group7.jpg",tooltip:"Arts & Hospitality"},{src:"group8.jpg",tooltip:"Other"}].map(function(t,a){e.append("img").attr("src","img dump/"+t.src).attr("alt","legend").style("cursor","pointer").on("mouseover",function(){n.text(t.tooltip),n.style("visibility","visible")}).on("mousemove",function(){n.style("top",24*a+5+"px").style("right","40px")}).on("mouseout",function(){return n.style("visibility","hidden")})})}(),c(s),e.isFunction(o)&&o()}(0,i)};var a=t.format(",");function i(t,e){var n=(i.canvas||(i.canvas=document.createElement("canvas"))).getContext("2d");return n.font=e||'24px "Helvetica Neue"',n.measureText(t).width}var r=function(){function e(t){_classCallCheck(this,e),this.data=t.data,this.year=t.year||"",this.datas=t.datas,this.years=t.years||"",this.absMaxX=t.absMaxX||0,this.absMaxY=t.absMaxY||0,this.element=t.element,this.draw()}return _createClass(e,[{key:"draw",value:function(){this.width=this.element.offsetWidth||400,this.height=this.element.offsetHeight||400;var e=Math.min(this.width,this.height);this.width=e,this.height=e,this.margin={top:40,right:40,bottom:40,left:40},this.width=this.width-(this.margin.left+this.margin.right),this.height=this.height-(this.margin.top+this.margin.bottom);var n=t.select(this.element);n.selectAll(".item").remove(),this.padding=n.node().getBoundingClientRect();var a=n.append("svg").attr("class","item").attr("width",this.width+(this.margin.left+this.margin.right)).attr("height",this.height+(this.margin.top+this.margin.bottom));this.container=a.append("g").attr("width",this.width).attr("height",this.height).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.createBubbles()}},{key:"setData",value:function(t){this.data=t,this.draw()}},{key:"createBubbles",value:function(){var e=this,n=1.6,a=this,r=t.scaleLinear().range([0,this.width]),o=t.scaleLinear().range([this.height,0]),s=t.line().x(function(t){return r(t.x)}).y(function(t){return t.y>n?o(n):t.y<-n?o(-n):o(t.y)}),l=t.scaleLinear().range([2,18]).domain(t.extent(a.data,function(t){return+t.radius}));r.domain([-this.absMaxX,+this.absMaxX]),this.absMaxY>1.5?o.domain([-1.6,1.6]):o.domain([-this.absMaxY,this.absMaxY]);var c=Math.min(this.absMaxY,this.absMaxX);this.container.append("g").attr("class","x-axis axis").attr("transform","translate(0,"+this.height+")").call(t.axisBottom(r).tickSize(-this.height)),this.container.append("g").attr("class","y-axis axis").call(t.axisLeft(o).tickSize(-this.width)),this.container.append("rect").attr("class","around").attr("x",0).attr("y",0).attr("height",this.height).attr("width",this.width),this.container.append("line").attr("class","like-axis").attr("x1",0).attr("x2",this.width).attr("y1",o(0)).attr("y2",o(0)),this.container.append("line").attr("class","like-axis").attr("x1",r(0)).attr("x2",r(0)).attr("y1",0).attr("y2",this.height),this.container.append("text").attr("class","label-axis label-y-axis").attr("text-anchor","middle").attr("transform","translate("+(15-this.margin.left)+","+this.height/2+")rotate(-90)").text("Local Trend (% Change in # Employees)"),this.container.append("text").attr("class","label-axis label-x-axis").attr("text-anchor","middle").attr("transform","translate("+this.width/2+","+(this.height-(15-this.margin.bottom))+")").text("National Trend (% Change in # Employees)"),this.absMaxY>1.5&&(this.container.append("text").attr("class","more-than-y-max").attr("y",5).attr("x",-22.5).text(">1.5"),this.container.append("circle").attr("class","more-than-y-max").style("fill","#fff").style("stroke-width","0").attr("cx",r(0)).attr("cy",o(1.52)).attr("r",2),this.container.append("line").attr("class","more-than-y-max").attr("x1",r(-.02)).attr("x2",r(.02)).attr("y1",o(1.47)).attr("y2",o(1.53)),this.container.append("line").attr("class","more-than-y-max").attr("x1",r(-.02)).attr("x2",r(.02)).attr("y1",o(1.51)).attr("y2",o(1.57)));this.container.append("text").attr("class","year label").attr("y",this.height-5).attr("x",this.width-5).text(this.year);var d=this.container.append("text").attr("class","description label").attr("y",-10).attr("x",0).text(""),u=(this.padding,this.container.selectAll(".bubble").data(a.data).enter().append("circle").attr("class","bubble").style("stroke","#000").style("stroke-width","0").style("fill",function(t,e){return t.color}).attr("cy",function(t){return t["Local Trend"]>n?o(n):t["Local Trend"]<-n?o(-n):o(t["Local Trend"])}).attr("cx",function(t){return r(t["National Trend"])}).attr("r",function(t){return l(t.radius)}).style("cursor","pointer").on("mouseover",function(e){u.style("opacity",1),t.select(this).style("opacity",1);var n=i(e.Industry)||a.width+1;d.text(n<a.width?e.Industry:e.Industry.substring(0,38)+"..."),a.container.selectAll(".history").remove();var r=[];a.years.map(function(t){a.datas[t].map(function(t){e.Industry===t.Industry&&r.push({x:t["National Trend"],y:t["Local Trend"]})})}),a.container.append("path").data([r]).classed("history background-history",!0).attr("d",s);var o=t.transition().duration(1e3).ease(t.easeLinear),l=a.container.selectAll(".animated-history").data([r]);l.enter().append("path").classed("history animated-history",!0).merge(l).attr("d",s).attr("stroke-dasharray",function(t){return this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}),a.container.selectAll(".animated-history").transition(o).attr("stroke-dashoffset",0)}).on("mouseout",function(){d.text(""),e.container.selectAll(".history").remove(),u.style("opacity",1)}));this.container.append("line").attr("class","like-diagonal").attr("x1",r(-c)).attr("x2",r(+c)).attr("y1",o(-c)).attr("y2",o(+c))}}]),e}()}(d3,$,window),$(function(){window.vibrant||(window.vibrant={});var t,e=/INPUT|SELECT|TEXTAREA/i;$(document).bind("keydown keypress",function(t){8==t.which&&(!e.test(t.target.tagName)||t.target.disabled||t.target.readOnly)&&t.preventDefault()}),window.onpopstate=function(t){$(document).ready(function(){a(!0),loadPage({},!0)})},$(document).ready(function(){t=$("#loading-wrapper"),a(!0),$("#navigation .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var e=$(this).data("link-to");loadPage({page:e})}),loadPage({},!0)});var n={activity:{page:"activity",nav:"graphs",event:window.loadActivity,nextAjax:function(){t.addClass("hidden")}},trends:{page:"trends",nav:"graphs",event:window.loadTrends,nextAjax:function(){t.addClass("hidden")}},local:{page:"local",nav:"graphs",event:window.loadLocal,nextAjax:function(){t.addClass("hidden")}},swot:{page:"swot",nav:"graphs",event:window.loadSwot,nextAjax:function(){t.addClass("hidden")}},network:{page:"network",nav:"graphs",event:window.loadNetwork,nextAjax:function(){t.addClass("hidden")}}};function a(t){var e=$("#header").height();$("#container").css("margin-top",e),$("#page-wrapper").css("min-height",$(window).height()-e)}window.loadPage=function e(i,r){var o=i.page||function(t,e){e||(e=window.location.href),t=t.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+t+"(=([^&#]*)|&|#|$)").exec(e);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}("page",window.location.search)||"activity";"nolink"!==o&&(t.removeClass("hidden"),o=o.replace("#","").replace(/[^a-zA-Z]+/g,""),n[o]?o&&(window.history.pushState({page:o},o,"?page="+o),"graphs"===n[o].nav&&r&&($("#navigation .link-to").removeClass("link-to-active"),$("#navigation .link-to-"+n[o].nav).addClass("link-to-active"),$("#sub-navigation-wrapper").empty().load("graphs_nav.html",function(t){$("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+o).addClass("link-to-active"),$("#sub-navigation-wrapper .link-to").off().on("click",function(t){t.stopPropagation(),t.preventDefault();var n=$(this).data("link-to");"nolink"!==n&&($("#sub-navigation-wrapper .link-to").removeClass("link-to-active"),$("#sub-navigation-wrapper .link-to-"+n).addClass("link-to-active"),e({page:n}))}),a(!1)})),$("#page-wrapper").empty().load(n[o].page+".html",function(t){$.isFunction(n[o].callback)&&n[o].callback(),$.isFunction(n[o].prevAjax)&&n[o].prevAjax(),$.isFunction(n[o].event)&&n[o].event(n[o].nextAjax)})):window.open(window.location.origin+"?page=activity","_self"))},$(window).on("resize",a)});